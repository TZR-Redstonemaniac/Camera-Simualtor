±>
mC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Tests\IntersectionTester.cs
public 
class 
IntersectionTester 
:  !
MonoBehaviour" /
{0 1
[ 
Header 
( 
$str 
) 
] 
[ 
SerializeField &
]& '
private( /
Vector20 7
pos8 ;
;; <
[ 
SerializeField 
] 
private 
float "
rad# &
;& '
[

 
Header

 
(

 
$str

 
)

 
]

 
[

 
SerializeField

 (
]

( )
private

* 1
Vector2

2 9
	positionA

: C
;

C D
[ 
SerializeField 
] 
private 
Vector2 $
	positionB% .
;. /
[ 
SerializeField 
] 
private 
Vector2 $
	positionC% .
;. /
[ 
Header 
( 
$str 
) 
] 
[ 
SerializeField &
]& '
private( /
Camera0 6
cam7 :
;: ;
[ 
SerializeField 
] 
private 
float "
rayLen# )
;) *
private 
void 
Update 
( 
) 
{ 
Vector3 
mousePos 
= 
cam 
. 
ScreenToWorldPoint 1
(1 2
new2 5
Vector36 =
(= >
Input> C
.C D
mousePositionD Q
.Q R
xR S
,S T
InputU Z
.Z [
mousePosition[ h
.h i
yi j
,j k
cam 
. 
	transform 
. 
position "
." #
z# $
*% &
-' (
$num( )
)) *
)* +
;+ ,
float 
dir 
= 
MovementHelper "
." #
GetAngleInDegrees# 4
(4 5
pos5 8
,8 9
mousePos: B
)B C
;C D
Vector2 
	vectorDir 
= 
new 
(  
Mathf  %
.% &
Sin& )
() *
dir* -
*. /
Mathf0 5
.5 6
Deg2Rad6 =
)= >
,> ?
Mathf@ E
.E F
CosF I
(I J
dirJ M
*N O
MathfP U
.U V
Deg2RadV ]
)] ^
)^ _
;_ `
Vector2 
endPos 
= 
pos 
+ 
	vectorDir (
*) *
rayLen+ 1
;1 2
using 
( 
Draw 
. 
Command 
( 
cam 
)  
)  !
{" #
Draw 
. 
LineGeometry 
= 
LineGeometry  ,
., -
Volumetric3D- 9
;9 :
Draw 
. 
ThicknessSpace 
=  !
ThicknessSpace" 0
.0 1
Pixels1 7
;7 8
Draw 
. 
	Thickness 
= 
$num 
; 
Draw   
.   
Line   
(   
pos   
,   
endPos   !
,  ! "
Color  # (
.  ( )
gray  ) -
,  - .
Color  / 4
.  4 5
gray  5 9
)  9 :
;  : ;
Draw"" 
."" 
Triangle"" 
("" 
	positionA"" #
,""# $
	positionB""% .
,"". /
	positionC""0 9
,""9 :
Color""; @
.""@ A
white""A F
)""F G
;""G H
Draw## 
.## 
Disc## 
(## 
pos## 
,## 
rad## 
,## 

DiscColors##  *
.##* +
Flat##+ /
(##/ 0
Color##0 5
.##5 6
white##6 ;
)##; <
)##< =
;##= >
}$$ 	
DoesIntersect&& 
(&& 
	vectorDir&& 
)&&  
;&&  !
}'' 
private)) 
void)) 
DoesIntersect)) 
()) 
Vector2)) &
dir))' *
)))* +
{)), -
Vector3** 
edgeAB** 
=** 
	positionB** "
-**# $
	positionA**% .
;**. /
Vector3++ 
edgeAC++ 
=++ 
	positionC++ "
-++# $
	positionA++% .
;++. /
Vector3,, 
normalVector,, 
=,, 
Vector3,, &
.,,& '
Cross,,' ,
(,,, -
edgeAB,,- 3
,,,3 4
edgeAC,,5 ;
),,; <
;,,< =
Vector3-- 
ao-- 
=-- 
pos-- 
--- 
	positionA-- $
;--$ %
Vector3.. 
dao.. 
=.. 
Vector3.. 
... 
Cross.. #
(..# $
ao..$ &
,..& '
dir..( +
)..+ ,
;.., -
float00 
determinant00 
=00 
-00 
Vector300 $
.00$ %
Dot00% (
(00( )
dir00) ,
,00, -
normalVector00. :
)00: ;
;00; <
float11 
invDet11 
=11 
$num11 
/11 
determinant11 &
;11& '
float33 
dst33 
=33 
Vector333 
.33 
Dot33 
(33  
ao33  "
,33" #
normalVector33$ 0
)330 1
*332 3
invDet334 :
;33: ;
float44 
u44 
=44 
Vector344 
.44 
Dot44 
(44 
edgeAC44 $
,44$ %
dao44& )
)44) *
*44+ ,
invDet44- 3
;443 4
float55 
v55 
=55 
-55 
Vector355 
.55 
Dot55 
(55 
edgeAB55 %
,55% &
dao55' *
)55* +
*55, -
invDet55. 4
;554 5
float66 
w66 
=66 
$num66 
-66 
u66 
-66 
v66 
;66 
Debug88 
.88 
Log88 
(88 
normalVector88 
+88  
$str88! %
+88& '
dir88( +
)88+ ,
;88, -
if:: 

(:: 
determinant:: 
<:: 
$num:: 
||:: !
dst::" %
<::& '
$num::( )
||::* ,
u::- .
<::/ 0
$num::1 2
||::3 5
v::6 7
<::8 9
$num::: ;
||::< >
w::? @
<::A B
$num::C D
)::D E
return::F L
;::L M
Vector3<< 
p1<< 
=<< 
pos<< 
+<< 
dir<< 
*<<  
dst<<! $
;<<$ %
using>> 
(>> 
Draw>> 
.>> 
Command>> 
(>> 
cam>> 
)>>  
)>>  !
Draw>>" &
.>>& '
Disc>>' +
(>>+ ,
p1>>, .
,>>. /
rad>>0 3
,>>3 4

DiscColors>>5 ?
.>>? @
Flat>>@ D
(>>D E
Color>>E J
.>>J K
red>>K N
)>>N O
)>>O P
;>>P Q
}?? 
}@@ ¯4
kC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Objects\RayTracingMesh.cs
[ 
ExecuteAlways 
] 
public 
class 
RayTracingMesh 
: 
MonoBehaviour +
{, -
private 
static 
readonly 
int 

Glossiness  *
=+ ,
Shader- 3
.3 4
PropertyToID4 @
(@ A
$strA N
)N O
;O P
public 

RayTracingMaterial 
material &
;& '
public

 

readonly

 
List

 
<

 
Triangle

 !
>

! "
	triangles

# ,
=

- .
new

/ 2
(

2 3
)

3 4
;

4 5
private 
Material 
mat 
; 
private 
Mesh 
mesh 
; 
private 
void 
Start 
( 
) 
=> 
UpdateMeshData *
(* +
)+ ,
;, -
private 
void 
Update 
( 
) 
{ 
if 

( 
mat 
== 
null 
) 
mat 
= 
new "
Material# +
(+ ,
Shader, 2
.2 3
Find3 7
(7 8
$str8 B
)B C
)C D
;D E
mat 
. 
color 
= 
material 
. 
color "
;" #
mat 
. 
SetFloat 
( 

Glossiness 
,  
material! )
.) *

smoothness* 4
)4 5
;5 6
GetComponent 
< 
MeshRenderer !
>! "
(" #
)# $
.$ %
material% -
=. /
mat0 3
;3 4
} 
public 

void 
UpdateMeshData 
( 
)  
{! "
	triangles 
. 
Clear 
( 
) 
; 
mesh 
= 
GetComponent 
< 

MeshFilter &
>& '
(' (
)( )
.) *

sharedMesh* 4
;4 5
Vector3 
[ 
] 
vertices 
= 
mesh !
.! "
vertices" *
;* +
Vector3 
[ 
] 
normals 
= 
mesh  
.  !
normals! (
;( )
int 
[ 
] 
indices 
= 
mesh 
. 
	triangles &
;& '
Triangle!! 
triangle!! 
=!! 
new!! 
(!!  
)!!  !
;!!! "
for"" 
("" 
int"" 
i"" 
="" 
$num"" 
;"" 
i"" 
<"" 
indices"" #
.""# $
Length""$ *
;""* +
i"", -
+="". 0
$num""1 2
)""2 3
{""4 5
int## 
a## 
=## 
indices## 
[## 
i## 
]## 
;## 
int$$ 
b$$ 
=$$ 
indices$$ 
[$$ 
i$$ 
+$$ 
$num$$  !
]$$! "
;$$" #
int%% 
c%% 
=%% 
indices%% 
[%% 
i%% 
+%% 
$num%%  !
]%%! "
;%%" #
triangle'' 
.'' 
posA'' 
='' 
LocalToWorld'' (
(''( )
vertices'') 1
[''1 2
a''2 3
]''3 4
)''4 5
;''5 6
triangle(( 
.(( 
normalA(( 
=(( 
normals(( &
[((& '
a((' (
]((( )
;(() *
triangle** 
.** 
posB** 
=** 
LocalToWorld** (
(**( )
vertices**) 1
[**1 2
b**2 3
]**3 4
)**4 5
;**5 6
triangle++ 
.++ 
normalB++ 
=++ 
normals++ &
[++& '
b++' (
]++( )
;++) *
triangle-- 
.-- 
posC-- 
=-- 
LocalToWorld-- (
(--( )
vertices--) 1
[--1 2
c--2 3
]--3 4
)--4 5
;--5 6
triangle.. 
... 
normalC.. 
=.. 
normals.. &
[..& '
c..' (
]..( )
;..) *
	triangles// 
.// 
Add// 
(// 
triangle// "
)//" #
;//# $
triangle00 
=00 
new00 
Triangle00 #
(00# $
)00$ %
;00% &
}11 	
}22 
private44 
Vector344 
LocalToWorld44  
(44  !
Vector344! (
vertex44) /
)44/ 0
{441 2
Vector355 
objectPosition55 
=55  
	transform55! *
.55* +
position55+ 3
;553 4

Quaternion66 
objectRotation66 !
=66" #
	transform66$ -
.66- .
rotation66. 6
;666 7
Vector377 
objectScale77 
=77 
	transform77 '
.77' (

lossyScale77( 2
;772 3
Vector3:: 
scaledVertex:: 
=:: 
Vector3:: &
.::& '
Scale::' ,
(::, -
vertex::- 3
,::3 4
objectScale::5 @
)::@ A
;::A B
Vector3== 
rotatedVertex== 
=== 
objectRotation==  .
*==/ 0
scaledVertex==1 =
;=== >
Vector3@@ 
worldVertex@@ 
=@@ 
objectPosition@@ ,
+@@- .
rotatedVertex@@/ <
;@@< =
returnBB 
worldVertexBB 
;BB 
}CC 
publicEE 

structEE 
TriangleEE 
{EE 
publicFF 
Vector3FF 
posAFF 
,FF 
posBFF !
,FF! "
posCFF# '
;FF' (
publicGG 
Vector3GG 
normalAGG 
,GG 
normalBGG  '
,GG' (
normalCGG) 0
;GG0 1
}HH 
}II ø#
bC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Tests\CamTest.cs
[ 
ExecuteAlways 
] 
public 
class 
CamTest 
: 
MonoBehaviour $
{% &
[		 
SerializeField		 
]		 
private		 
bool		 !
run		" %
;		% &
[

 
SerializeField

 
]

 
private

 
Vector2

 $
debugPointCount

% 4
;

4 5
[ 
SerializeField 
] 
private 
float "
radius# )
;) *
private 
Camera 
cam 
; 
private 
void 
Start 
( 
) 
{ 
cam 
= 
Camera 
. 
main 
; 
} 
private 
void 
Update 
( 
) 
{ 
if 

( 
! 
run 
) 
return 
; 
	Transform 
camT 
= 
cam 
. 
	transform &
;& '
float 
planeHeight 
= 
cam 
.  
nearClipPlane  -
*. /
Mathf0 5
.5 6
Tan6 9
(9 :
cam: =
.= >
fieldOfView> I
*J K
$numL P
*Q R
MathfS X
.X Y
Deg2RadY `
)` a
*b c
$numd e
;e f
float 

planeWidth 
= 
planeHeight &
*' (
cam) ,
., -
aspect- 3
;3 4
Vector3 
bottomLeftLocal 
=  !
new" %
Vector3& -
(- .
-. /

planeWidth/ 9
/: ;
$num< =
,= >
-? @
planeHeight@ K
/L M
$numN O
,O P
camQ T
.T U
nearClipPlaneU b
)b c
;c d
for 
( 
int 
x 
= 
$num 
; 
x 
< 
debugPointCount +
.+ ,
x, -
;- .
x/ 0
++0 2
)2 3
{4 5
for   
(   
int   
y   
=   
$num   
;   
y   
<   
debugPointCount    /
.  / 0
y  0 1
;  1 2
y  3 4
++  4 6
)  6 7
{  8 9
float!! 
tx!! 
=!! 
x!! 
/!! 
(!!  
debugPointCount!!  /
.!!/ 0
x!!0 1
-!!2 3
$num!!4 6
)!!6 7
;!!7 8
float"" 
ty"" 
="" 
y"" 
/"" 
(""  
debugPointCount""  /
.""/ 0
y""0 1
-""2 3
$num""4 6
)""6 7
;""7 8
Vector3$$ 

pointLocal$$ "
=$$# $
bottomLeftLocal$$% 4
+$$5 6
new$$7 :
Vector3$$; B
($$B C

planeWidth$$C M
*$$N O
tx$$P R
,$$R S
planeHeight$$T _
*$$` a
ty$$b d
)$$d e
;$$e f
Vector3%% 
point%% 
=%% 
camT%%  $
.%%$ %
position%%% -
+%%. /
camT%%0 4
.%%4 5
right%%5 :
*%%; <

pointLocal%%= G
.%%G H
x%%H I
+%%J K
camT%%L P
.%%P Q
up%%Q S
*%%T U

pointLocal%%V `
.%%` a
y%%a b
+%%c d
camT%%e i
.%%i j
forward%%j q
*%%r s

pointLocal%%t ~
.%%~ 
z	%% Ä
;
%%Ä Å
using'' 
('' 
Draw'' 
.'' 
Command'' #
(''# $
cam''% (
)'') *
)''* +
Draw'', 0
.''0 1
Sphere''1 7
(''7 8
point''8 =
,''= >
radius''? E
,''E F
Color''G L
.''L M
white''M R
)''R S
;''S T
}(( 
})) 	
}** 
}++ ”
eC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Tests\Screenshot.cs
public 
class 

Screenshot 
: 
MonoBehaviour '
{( )
public 

void 
TakeScreenshot 
( 
)  
{! "
string 
	directory 
= 
Application &
.& '
dataPath' /
+0 1
$str2 <
;< =
if		 

(		 
!		 
	Directory		 
.		 
Exists		 
(		 
	directory		 '
)		' (
)		( )
	Directory		* 3
.		3 4
CreateDirectory		4 C
(		C D
	directory		D M
)		M N
;		N O
string 
fileName 
= 
$str "
+# $
DateTime% -
.- .
Now. 1
.1 2
ToString2 :
(: ;
$str; P
)P Q
+R S
$strT Z
;Z [
string 
filePath 
= 
Path 
. 
Combine &
(& '
	directory' 0
,0 1
fileName2 :
): ;
;; <
ScreenCapture 
. 
CaptureScreenshot '
(' (
filePath( 0
)0 1
;1 2
Debug 
. 
Log 
( 
$str &
+' (
filePath) 1
)1 2
;2 3
} 
} ‰
cC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\MovementHelper.cs
	namespace 	
Helpers
 
; 
public 
static 
class 
MovementHelper "
{# $
public 

static 
Vector2  
GetResultingPosition .
(. /
Vector2/ 6
startPosition7 D
,D E
floatF K
angleDegreesL X
,X Y
floatZ _
distance` h
)h i
{j k
float 
angleRadians 
= 
( 
$num  
-! "
angleDegrees# /
)/ 0
*1 2
Mathf3 8
.8 9
Deg2Rad9 @
;@ A
float

 
deltaX

 
=

 
Mathf

 
.

 
Cos

  
(

  !
angleRadians

! -
)

- .
*

/ 0
distance

1 9
;

9 :
float 
deltaY 
= 
Mathf 
. 
Sin  
(  !
angleRadians! -
)- .
*/ 0
distance1 9
;9 :
Vector2 
resultingPosition !
=" #
startPosition$ 1
+2 3
new4 7
Vector28 ?
(? @
deltaX@ F
,F G
deltaYH N
)N O
;O P
return 
resultingPosition  
;  !
} 
public 

static 
float 
GetAngleInDegrees )
() *
Vector2* 1
point12 8
,8 9
Vector2: A
point2B H
)H I
{J K
Vector2 
	direction 
= 
point2 "
-# $
point1% +
;+ ,
float 
angleRadians 
= 
Mathf "
." #
Atan2# (
(( )
	direction) 2
.2 3
x3 4
,4 5
	direction6 ?
.? @
y@ A
)A B
;B C
float 
angleDegrees 
= 
angleRadians )
** +
Mathf, 1
.1 2
Rad2Deg2 9
;9 :
if 

( 
angleDegrees 
< 
$num 
) 
{ 	
angleDegrees   
+=   
$num   
;    
}!! 	
return## 
angleDegrees## 
;## 
}$$ 
}%% µ	
oC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Objects\RayTracingMaterial.cs
[ 
Serializable 
] 
public 
struct 
RayTracingMaterial  
{! "
[ 
Header 
( 
$str 
) 
] 
public 

Color 
color 
; 
public 

Color 
emissionColor 
; 
public		 

Color		 
specularColor		 
;		 
[ 
Header 
( 
$str 
) 
] 
public 

float 
emissionStrength !
;! "
[ 
Range 

(
 
$num 
, 
$num 
) 
] 
public 
float 

smoothness )
;) *
[ 
Range 

(
 
$num 
, 
$num 
) 
] 
public 
float 
specularProbability 2
;2 3
} É
iC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Objects\SphereObject.cs
[ 
ExecuteAlways 
] 
public 
class 
SphereObject 
: 
MonoBehaviour )
{* +
private 
static 
readonly 
int 

Glossiness  *
=+ ,
Shader- 3
.3 4
PropertyToID4 @
(@ A
$strA N
)N O
;O P
public 

RayTracingMaterial 
material &
;& '
private		 
Material		 
mat		 
;		 
private 
void 
Update 
( 
) 
{ 
if 

( 
mat 
== 
null 
) 
mat 
= 
new "
Material# +
(+ ,
Shader, 2
.2 3
Find3 7
(7 8
$str8 B
)B C
)C D
;D E
mat 
. 
color 
= 
material 
. 
color "
;" #
mat 
. 
SetFloat 
( 

Glossiness 
,  
material! )
.) *

smoothness* 4
)4 5
;5 6
GetComponent 
< 
MeshRenderer !
>! "
(" #
)# $
.$ %
material% -
=. /
mat0 3
;3 4
} 
} ë
iC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Tests\ShaderRenderer.cs
[ 
ExecuteAlways 
] 
public 
class 
ShaderRenderer 
: 
MonoBehaviour +
{, -
[ 
SerializeField 
] 
private 
Shader #
shader$ *
;* +
private 
Material 
rayTracingMat "
;" #
private		 
void		 
Start		 
(		 
)		 
=>		 
rayTracingMat		 )
=		* +
new		, /
Material		0 8
(		8 9
shader		9 ?
)		? @
;		@ A
private 
void 
OnRenderImage 
( 
RenderTexture ,
source- 3
,3 4
RenderTexture5 B
destinationC N
)N O
{P Q
if 

( 
Camera 
. 
current 
. 
name 
!=  "
$str# 0
)0 1
Graphics2 :
.: ;
Blit; ?
(? @
null@ D
,D E
destinationF Q
,Q R
rayTracingMatS `
)` a
;a b
else 
Graphics 
. 
Blit 
( 
source !
,! "
destination# .
). /
;/ 0
} 
} Ü∑
oC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Managers\RayTracingManager.cs
	namespace 	
Managers
 
; 
[ 
ExecuteAlways 
] 
[ )
ImageEffectAllowedInSceneView 
] 
public 
class 
RayTracingManager 
:  
MonoBehaviour! .
{/ 0
private 
static 
readonly 
int 
Spheres  '
=( )
Shader* 0
.0 1
PropertyToID1 =
(= >
$str> G
)G H
;H I
private 
static 
readonly 
int 
	Triangles  )
=* +
Shader, 2
.2 3
PropertyToID3 ?
(? @
$str@ K
)K L
;L M
private 
static 
readonly 
int 
AllMeshInfo  +
=, -
Shader. 4
.4 5
PropertyToID5 A
(A B
$strB O
)O P
;P Q
private 
static 
readonly 
int 
NumOfSpheres  ,
=- .
Shader/ 5
.5 6
PropertyToID6 B
(B C
$strC Q
)Q R
;R S
private 
static 
readonly 
int 
BounceCount  +
=, -
Shader. 4
.4 5
PropertyToID5 A
(A B
$strB R
)R S
;S T
private 
static 
readonly 
int 
RaysPerPixel  ,
=- .
Shader/ 5
.5 6
PropertyToID6 B
(B C
$strC T
)T U
;U V
private 
static 
readonly 
int 
RenderedFrames  .
=/ 0
Shader1 7
.7 8
PropertyToID8 D
(D E
$strE X
)X Y
;Y Z
private 
static 
readonly 
int 
	Intensity  )
=* +
Shader, 2
.2 3
PropertyToID3 ?
(? @
$str@ N
)N O
;O P
private 
static 
readonly 
int 
Focus  %
=& '
Shader( .
.. /
PropertyToID/ ;
(; <
$str< F
)F G
;G H
private 
static 
readonly 
int 
ColorHorizon  ,
=- .
Shader/ 5
.5 6
PropertyToID6 B
(B C
$strC T
)T U
;U V
private 
static 
readonly 
int 
ColorZenith  +
=, -
Shader. 4
.4 5
PropertyToID5 A
(A B
$strB R
)R S
;S T
private 
static 
readonly 
int 
GroundColor1  ,
=- .
Shader/ 5
.5 6
PropertyToID6 B
(B C
$strC P
)P Q
;Q R
private 
static 
readonly 
int 

ViewParams  *
=+ ,
Shader- 3
.3 4
PropertyToID4 @
(@ A
$strA M
)M N
;N O
private 
static 
readonly 
int !
CamLocalToWorldMatrix  5
=6 7
Shader8 >
.> ?
PropertyToID? K
(K L
$strL c
)c d
;d e
private 
static 
readonly 
int 
Frames  &
=' (
Shader) /
./ 0
PropertyToID0 <
(< =
$str= Q
)Q R
;R S
private 
static 
readonly 
int 
	PrevFrame  )
=* +
Shader, 2
.2 3
PropertyToID3 ?
(? @
$str@ L
)L M
;M N
private 
static 
readonly 
int 
	NumMeshes  )
=* +
Shader, 2
.2 3
PropertyToID3 ?
(? @
$str@ K
)K L
;L M
private   
static   
readonly   
int   
UseEnvironment    .
=  / 0
Shader  1 7
.  7 8
PropertyToID  8 D
(  D E
$str  E U
)  U V
;  V W
private!! 
static!! 
readonly!! 
int!! 
Strength!!  (
=!!) *
Shader!!+ 1
.!!1 2
PropertyToID!!2 >
(!!> ?
$str!!? P
)!!P Q
;!!Q R
private"" 
static"" 
readonly"" 
int"" 
DefocusStrength1""  0
=""1 2
Shader""3 9
.""9 :
PropertyToID"": F
(""F G
$str""G X
)""X Y
;""Y Z
[$$ 
Header$$ 
($$ 
$str$$ 
)$$ 
]$$ 
[%% 
SerializeField%% 
]%% 
private%% 
Shader%% #
rayTracingShader%%$ 4
;%%4 5
['' 
SerializeField'' 
]'' 
private'' 
Shader'' #
companionShader''$ 3
;''3 4
[(( 
SerializeField(( 
](( 
private(( 
Camera(( #
mainCam(($ +
;((+ ,
[** 
Header** 
(** 
$str** 
)** 
]** 
[++ 
SerializeField++ 
]++ 
private++ 
bool++ ! 
useShaderInSceneView++" 6
;++6 7
[-- 
SerializeField-- 
]-- 
[-- 
Range-- 
(-- 
$num-- 
,-- 
$num-- !
)--! "
]--" #
private--$ +
int--, /
MaxBounceCount--0 >
;--> ?
[.. 
SerializeField.. 
].. 
[.. 
Range.. 
(.. 
$num.. 
,.. 
$num.. !
)..! "
].." #
private..$ +
int.., /
NumRaysPerPixel..0 ?
;..? @
[// 
SerializeField// 
]// 
[// 
Min// 
(// 
$num// 
)// 
]// 
private// %
float//& +
DivergeStrength//, ;
;//; <
[00 
SerializeField00 
]00 
[00 
Min00 
(00 
$num00 
)00 
]00 
private00 %
float00& +
DefocusStrength00, ;
;00; <
[11 
SerializeField11 
]11 
[11 
Min11 
(11 
$num11 
)11 
]11  
private11! (
float11) .
FocusDistance11/ <
;11< =
[22 
SerializeField22 
]22 
[22 
Min22 
(22 
$num22 
)22 
]22  
private22! (
float22) .
RenderDistance22/ =
;22= >
[44 
Header44 
(44 
$str44 
)44 
]44 
[55 
SerializeField55 
]55 
private55 
bool55 !
environment55" -
;55- .
[77 
SerializeField77 
]77 
private77 
bool77 !
visualizeFocus77" 0
;770 1
[99 
SerializeField99 
]99 
private99 
Color99 "
SkyColorHorizon99# 2
;992 3
[:: 
SerializeField:: 
]:: 
private:: 
Color:: "
SkyColorZenith::# 1
;::1 2
[;; 
SerializeField;; 
];; 
private;; 
Color;; "
GroundColor;;# .
;;;. /
[<< 
SerializeField<< 
]<< 
private<< 
float<< "
SunFocus<<# +
;<<+ ,
[== 
SerializeField== 
]== 
private== 
float== "
SunIntensity==# /
;==/ 0
private?? 
Material?? 
companionMat?? !
;??! "
privateAA 
RenderTextureAA 
currentTextureAA (
;AA( )
privateCC 
boolCC 
initCC 
;CC 
privateDD 
RayTracingMeshDD 
[DD 
]DD 
meshesDD #
;DD# $
privateEE 
ComputeBufferEE 

meshReaderEE $
;EE$ %
privateGG 
intGG 
NumRenderedFramesGG !
;GG! "
privateII 
MaterialII 
rayTracingMatII "
;II" #
privateKK 
ComputeBufferKK 
sphereReaderKK &
;KK& '
privateMM 
SphereObjectMM 
[MM 
]MM 
spheresMM "
;MM" #
privateNN 
ComputeBufferNN 
triangleReaderNN (
;NN( )
privateOO 
staticOO 
readonlyOO 
intOO 
DistanceOO  (
=OO) *
ShaderOO+ 1
.OO1 2
PropertyToIDOO2 >
(OO> ?
$strOO? O
)OOO P
;OOP Q
privateQQ 
voidQQ 
StartQQ 
(QQ 
)QQ 
=>QQ 
InitShadersQQ '
(QQ' (
)QQ( )
;QQ) *
privateSS 
voidSS 
	OnDestroySS 
(SS 
)SS 
{SS 

meshReaderTT 
?TT 
.TT 
ReleaseTT 
(TT 
)TT 
;TT 
sphereReaderUU 
?UU 
.UU 
ReleaseUU 
(UU 
)UU 
;UU  
triangleReaderVV 
?VV 
.VV 
ReleaseVV 
(VV  
)VV  !
;VV! "

meshReaderWW 
?WW 
.WW 
DisposeWW 
(WW 
)WW 
;WW 
sphereReaderXX 
?XX 
.XX 
DisposeXX 
(XX 
)XX 
;XX  
triangleReaderYY 
?YY 
.YY 
DisposeYY 
(YY  
)YY  !
;YY! "
}ZZ 
private\\ 
void\\ 
OnRenderImage\\ 
(\\ 
RenderTexture\\ ,
src\\- 0
,\\0 1
RenderTexture\\2 ?
target\\@ F
)\\F G
{\\H I
if]] 

(]] 
!]] 
init]] 
)]] 
Init]] 
(]] 
src]] 
)]] 
;]] 
if__ 

(__ 
visualizeFocus__ 
)__ 
{__ 
Camera`` 
cam`` 
=``  
useShaderInSceneView`` -
?``. /
Camera``0 6
.``6 7
current``7 >
:``? @
mainCam``A H
;``H I
floatbb 
frustumHeightbb 
=bb  !
$numbb" &
*bb' (
Mathfbb) .
.bb. /
Tanbb/ 2
(bb2 3
cambb3 6
.bb6 7
fieldOfViewbb7 B
*bbC D
$numbbE I
*bbJ K
MathfbbL Q
.bbQ R
Deg2RadbbR Y
)bbY Z
*bb[ \
FocusDistancebb] j
;bbj k
floatcc 
frustumWidthcc 
=cc  
frustumHeightcc! .
*cc/ 0
camcc1 4
.cc4 5
aspectcc5 ;
;cc; <
Vector3ee 
topLeftFrustumLineee &
=ee' (
camee) ,
.ee, -
	transformee- 6
.ee6 7
positionee7 ?
+ee@ A
cameeB E
.eeE F
	transformeeF O
.eeO P
righteeP U
*eeV W
(eeX Y
-eeY Z
frustumWidtheeZ f
*eeg h
$numeei m
)eem n
+eeo p
camff 
.ff 
	transformff 
.ff 
upff  
*ff! "
(ff# $
frustumHeightff$ 1
*ff2 3
$numff4 8
)ff8 9
+ff: ;
camff< ?
.ff? @
	transformff@ I
.ffI J
forwardffJ Q
*ffR S
FocusDistanceffT a
;ffa b
Vector3hh 
topRightFrustumLinehh '
=hh( )
camhh* -
.hh- .
	transformhh. 7
.hh7 8
positionhh8 @
+hhA B
camhhC F
.hhF G
	transformhhG P
.hhP Q
righthhQ V
*hhW X
(hhY Z
frustumWidthhhZ f
*hhg h
$numhhi m
)hhm n
+hho p
camii 
.ii 
	transformii 
.ii 
upii  
*ii! "
(ii# $
frustumHeightii$ 1
*ii2 3
$numii4 8
)ii8 9
+ii: ;
camii< ?
.ii? @
	transformii@ I
.iiI J
forwardiiJ Q
*iiR S
FocusDistanceiiT a
;iia b
Vector3kk "
bottomRightFrustumLinekk *
=kk+ ,
camkk- 0
.kk0 1
	transformkk1 :
.kk: ;
positionkk; C
+kkD E
camkkF I
.kkI J
	transformkkJ S
.kkS T
rightkkT Y
*kkZ [
(kk\ ]
frustumWidthkk] i
*kkj k
$numkkl p
)kkp q
-kkr s
camll 
.ll 
	transformll 
.ll 
upll  
*ll! "
(ll# $
frustumHeightll$ 1
*ll2 3
$numll4 8
)ll8 9
+ll: ;
camll< ?
.ll? @
	transformll@ I
.llI J
forwardllJ Q
*llR S
FocusDistancellT a
;lla b
Vector3nn !
bottomLeftFrustumLinenn )
=nn* +
camnn, /
.nn/ 0
	transformnn0 9
.nn9 :
positionnn: B
+nnC D
camnnE H
.nnH I
	transformnnI R
.nnR S
rightnnS X
*nnY Z
(nn[ \
-nn\ ]
frustumWidthnn] i
*nnj k
$numnnl p
)nnp q
-nnr s
camoo 
.oo 
	transformoo 
.oo 
upoo  
*oo! "
(oo# $
frustumHeightoo$ 1
*oo2 3
$numoo4 8
)oo8 9
+oo: ;
camoo< ?
.oo? @
	transformoo@ I
.ooI J
forwardooJ Q
*ooR S
FocusDistanceooT a
;ooa b
ifqq 
(qq 
Cameraqq 
.qq 
currentqq 
.qq 
nameqq #
==qq$ &
$strqq' 4
)qq4 5
{qq6 7
usingrr 
(rr 
Drawrr 
.rr 
Commandrr #
(rr# $
Camerarr$ *
.rr* +
currentrr+ 2
)rr2 3
)rr3 4
{rr5 6
Colorss 
colorss 
=ss  !
Colorss" '
.ss' (
greenss( -
;ss- .
colortt 
.tt 
att 
=tt 
$numtt #
;tt# $
Drawuu 
.uu 
Quaduu 
(uu 
topRightFrustumLineuu 1
,uu1 2
topLeftFrustumLineuu3 E
,uuE F!
bottomLeftFrustumLineuuG \
,uu\ ]"
bottomRightFrustumLineuu^ t
,uut u
coloruuv {
)uu{ |
;uu| }
}vv 
}ww 
}xx 	
ifzz 

(zz  
useShaderInSceneViewzz  
&&zz! #
!zz$ %
Applicationzz% 0
.zz0 1
	isPlayingzz1 :
)zz: ;
{zz< =
InitShaders{{ 
({{ 
){{ 
;{{ 
UpdateCameraParams}} 
(}} 
Camera}} %
.}}% &
current}}& -
)}}- .
;}}. / 
UpdateMaterialParams~~  
(~~  !
)~~! "
;~~" #
Graphics
ÄÄ 
.
ÄÄ 
Blit
ÄÄ 
(
ÄÄ 
null
ÄÄ 
,
ÄÄ 
target
ÄÄ  &
,
ÄÄ& '
rayTracingMat
ÄÄ( 5
)
ÄÄ5 6
;
ÄÄ6 7
}
ÅÅ 	
else
ÅÅ
 
if
ÅÅ 
(
ÅÅ 
Camera
ÅÅ 
.
ÅÅ 
current
ÅÅ !
.
ÅÅ! "
name
ÅÅ" &
!=
ÅÅ' )
$str
ÅÅ* 7
)
ÅÅ7 8
{
ÅÅ9 :
InitShaders
ÇÇ 
(
ÇÇ 
)
ÇÇ 
;
ÇÇ  
UpdateCameraParams
ÑÑ 
(
ÑÑ 
Camera
ÑÑ %
.
ÑÑ% &
current
ÑÑ& -
)
ÑÑ- .
;
ÑÑ. /"
UpdateMaterialParams
ÖÖ  
(
ÖÖ  !
)
ÖÖ! "
;
ÖÖ" #
RenderTexture
áá 
prevFrameCopy
áá '
=
áá( )
RenderTexture
áá* 7
.
áá7 8
GetTemporary
áá8 D
(
ááD E
src
ááE H
.
ááH I
width
ááI N
,
ááN O
src
ááP S
.
ááS T
height
ááT Z
,
ááZ [
$num
áá\ ]
,
áá] ^
GraphicsFormat
áá_ m
.
áám n"
R32G32B32A32_SFloatáán Å
)ááÅ Ç
;ááÇ É
Graphics
àà 
.
àà 
Blit
àà 
(
àà 
currentTexture
àà (
,
àà( )
prevFrameCopy
àà* 7
)
àà7 8
;
àà8 9
NumRenderedFrames
ää 
+=
ää  
Application
ää! ,
.
ää, -
	isPlaying
ää- 6
?
ää7 8
$num
ää9 :
:
ää; <
$num
ää= >
;
ää> ?"
UpdateMaterialParams
ãã  
(
ãã  !
)
ãã! "
;
ãã" #
RenderTexture
åå 
currentFrame
åå &
=
åå' (
RenderTexture
åå) 6
.
åå6 7
GetTemporary
åå7 C
(
ååC D
src
ååD G
.
ååG H
width
ååH M
,
ååM N
src
ååO R
.
ååR S
height
ååS Y
,
ååY Z
$num
åå[ \
,
åå\ ]
GraphicsFormat
åå^ l
.
åål m"
R32G32B32A32_SFloatååm Ä
)ååÄ Å
;ååÅ Ç
Graphics
çç 
.
çç 
Blit
çç 
(
çç 
null
çç 
,
çç 
currentFrame
çç  ,
,
çç, -
rayTracingMat
çç. ;
)
çç; <
;
çç< =
companionMat
èè 
.
èè 
SetInt
èè 
(
èè  
Frames
èè  &
,
èè& '
NumRenderedFrames
èè( 9
)
èè9 :
;
èè: ;
companionMat
êê 
.
êê 

SetTexture
êê #
(
êê# $
	PrevFrame
êê$ -
,
êê- .
prevFrameCopy
êê/ <
)
êê< =
;
êê= >
Graphics
ëë 
.
ëë 
Blit
ëë 
(
ëë 
currentFrame
ëë &
,
ëë& '
currentTexture
ëë( 6
,
ëë6 7
companionMat
ëë8 D
)
ëëD E
;
ëëE F
Graphics
ìì 
.
ìì 
Blit
ìì 
(
ìì 
currentTexture
ìì (
,
ìì( )
target
ìì* 0
)
ìì0 1
;
ìì1 2
RenderTexture
ïï 
.
ïï 
ReleaseTemporary
ïï *
(
ïï* +
currentFrame
ïï+ 7
)
ïï7 8
;
ïï8 9
RenderTexture
ññ 
.
ññ 
ReleaseTemporary
ññ *
(
ññ* +
prevFrameCopy
ññ+ 8
)
ññ8 9
;
ññ9 :
RenderTexture
óó 
.
óó 
ReleaseTemporary
óó *
(
óó* +
currentFrame
óó+ 7
)
óó7 8
;
óó8 9
}
òò 	
else
òò
 
Graphics
òò 
.
òò 
Blit
òò 
(
òò 
src
òò  
,
òò  !
target
òò" (
)
òò( )
;
òò) *
}
ôô 
private
õõ 
void
õõ 
InitShaders
õõ 
(
õõ 
)
õõ 
{
õõ  
rayTracingMat
úú 
=
úú 
new
úú 
Material
úú $
(
úú$ %
rayTracingShader
úú% 5
)
úú5 6
;
úú6 7
companionMat
ùù 
=
ùù 
new
ùù 
Material
ùù #
(
ùù# $
companionShader
ùù$ 3
)
ùù3 4
;
ùù4 5

meshReader
üü 
?
üü 
.
üü 
Release
üü 
(
üü 
)
üü 
;
üü 
sphereReader
†† 
?
†† 
.
†† 
Release
†† 
(
†† 
)
†† 
;
††  
triangleReader
°° 
?
°° 
.
°° 
Release
°° 
(
°°  
)
°°  !
;
°°! "

meshReader
¢¢ 
?
¢¢ 
.
¢¢ 
Dispose
¢¢ 
(
¢¢ 
)
¢¢ 
;
¢¢ 
sphereReader
££ 
?
££ 
.
££ 
Dispose
££ 
(
££ 
)
££ 
;
££  
triangleReader
§§ 
?
§§ 
.
§§ 
Dispose
§§ 
(
§§  
)
§§  !
;
§§! "
meshes
¶¶ 
=
¶¶ 
FindObjectsOfType
¶¶ "
<
¶¶" #
RayTracingMesh
¶¶# 1
>
¶¶1 2
(
¶¶2 3
)
¶¶3 4
;
¶¶4 5
foreach
ßß 
(
ßß 
RayTracingMesh
ßß 
mesh
ßß  $
in
ßß% '
meshes
ßß( .
)
ßß. /
mesh
ßß0 4
.
ßß4 5
UpdateMeshData
ßß5 C
(
ßßC D
)
ßßD E
;
ßßE F
int
®® 
size
®® 
=
®® 
meshes
®® 
.
®® 
Sum
®® 
(
®® 
mesh
®® "
=>
®®# %
mesh
®®& *
.
®®* +
	triangles
®®+ 4
.
®®4 5
Count
®®5 :
)
®®: ;
;
®®; <
if
™™ 

(
™™ 
size
™™ 
>
™™ 
$num
™™ 
)
™™ 
{
™™ 
const
´´ 
int
´´ 
triangleSize
´´ "
=
´´# $
sizeof
´´% +
(
´´+ ,
float
´´, 1
)
´´1 2
*
´´3 4
$num
´´5 7
;
´´7 8
const
¨¨ 
int
¨¨ 
meshSize
¨¨ 
=
¨¨  
sizeof
¨¨! '
(
¨¨' (
float
¨¨( -
)
¨¨- .
*
¨¨/ 0
$num
¨¨1 3
+
¨¨4 5
sizeof
¨¨6 <
(
¨¨< =
int
¨¨= @
)
¨¨@ A
*
¨¨B C
$num
¨¨D E
;
¨¨E F
triangleReader
≠≠ 
=
≠≠ 
new
≠≠  
ComputeBuffer
≠≠! .
(
≠≠. /
size
≠≠/ 3
,
≠≠3 4
triangleSize
≠≠5 A
)
≠≠A B
;
≠≠B C

meshReader
ÆÆ 
=
ÆÆ 
new
ÆÆ 
ComputeBuffer
ÆÆ *
(
ÆÆ* +
meshes
ÆÆ+ 1
.
ÆÆ1 2
Length
ÆÆ2 8
,
ÆÆ8 9
meshSize
ÆÆ: B
)
ÆÆB C
;
ÆÆC D
}
ØØ 	
spheres
±± 
=
±± 
FindObjectsOfType
±± #
<
±±# $
SphereObject
±±$ 0
>
±±0 1
(
±±1 2
)
±±2 3
;
±±3 4
if
≥≥ 

(
≥≥ 
spheres
≥≥ 
.
≥≥ 
Length
≥≥ 
>
≥≥ 
$num
≥≥ 
)
≥≥ 
{
≥≥  !
const
¥¥ 
int
¥¥ 

sphereSize
¥¥  
=
¥¥! "
sizeof
¥¥# )
(
¥¥) *
float
¥¥* /
)
¥¥/ 0
*
¥¥1 2
$num
¥¥3 5
;
¥¥5 6
sphereReader
µµ 
=
µµ 
new
µµ 
ComputeBuffer
µµ ,
(
µµ, -
spheres
µµ- 4
.
µµ4 5
Length
µµ5 ;
,
µµ; <

sphereSize
µµ= G
)
µµG H
;
µµH I
}
∂∂ 	
}
∑∑ 
private
ππ 
void
ππ 
Init
ππ 
(
ππ 
RenderTexture
ππ #
src
ππ$ '
)
ππ' (
{
ππ) *
int
∫∫ 
width
∫∫ 
=
∫∫ 
src
∫∫ 
.
∫∫ 
width
∫∫ 
;
∫∫ 
int
ªª 
height
ªª 
=
ªª 
src
ªª 
.
ªª 
height
ªª 
;
ªª  
int
ºº 
	depthMode
ºº 
=
ºº 
src
ºº 
.
ºº 
depth
ºº !
;
ºº! "
GraphicsFormat
ææ 
format
ææ 
=
ææ 
src
ææ  #
.
ææ# $
graphicsFormat
ææ$ 2
;
ææ2 3
bool
¿¿ 

useMipMaps
¿¿ 
=
¿¿ 
src
¿¿ 
.
¿¿ 
	useMipMap
¿¿ '
;
¿¿' (
currentTexture
¬¬ 
=
¬¬ 
new
¬¬ 
RenderTexture
¬¬ *
(
¬¬* +
width
¬¬+ 0
,
¬¬0 1
height
¬¬2 8
,
¬¬8 9
	depthMode
¬¬: C
)
¬¬C D
{
¬¬E F
graphicsFormat
√√ 
=
√√ 
format
√√ #
,
√√# $
enableRandomWrite
√√% 6
=
√√7 8
true
√√9 =
,
√√= >
autoGenerateMips
√√? O
=
√√P Q
false
√√R W
,
√√W X
	useMipMap
√√Y b
=
√√c d

useMipMaps
√√e o
}
ƒƒ 	
;
ƒƒ	 

currentTexture
∆∆ 
.
∆∆ 
Create
∆∆ 
(
∆∆ 
)
∆∆ 
;
∆∆  
init
»» 
=
»» 
true
»» 
;
»» 
}
…… 
private
ÀÀ 
void
ÀÀ  
UpdateCameraParams
ÀÀ #
(
ÀÀ# $
Camera
ÀÀ$ *
cam
ÀÀ+ .
)
ÀÀ. /
{
ÀÀ0 1
rayTracingMat
ÃÃ 
=
ÃÃ 
new
ÃÃ 
Material
ÃÃ $
(
ÃÃ$ %
rayTracingShader
ÃÃ% 5
)
ÃÃ5 6
;
ÃÃ6 7
companionMat
ÕÕ 
=
ÕÕ 
new
ÕÕ 
Material
ÕÕ #
(
ÕÕ# $
companionShader
ÕÕ$ 3
)
ÕÕ3 4
;
ÕÕ4 5
float
œœ 
planeHeight
œœ 
=
œœ 
FocusDistance
œœ )
*
œœ* +
Mathf
œœ, 1
.
œœ1 2
Tan
œœ2 5
(
œœ5 6
cam
œœ6 9
.
œœ9 :
fieldOfView
œœ: E
*
œœF G
$num
œœH L
*
œœM N
Mathf
œœO T
.
œœT U
Deg2Rad
œœU \
)
œœ\ ]
*
œœ^ _
$num
œœ` a
;
œœa b
float
–– 

planeWidth
–– 
=
–– 
planeHeight
–– &
*
––' (
cam
––) ,
.
––, -
aspect
––- 3
;
––3 4
rayTracingMat
““ 
.
““ 
	SetVector
““ 
(
““  

ViewParams
““  *
,
““* +
new
““, /
Vector3
““0 7
(
““7 8

planeWidth
““8 B
,
““B C
planeHeight
““D O
,
““O P
FocusDistance
““Q ^
)
““^ _
)
““_ `
;
““` a
rayTracingMat
”” 
.
”” 
	SetMatrix
”” 
(
””  #
CamLocalToWorldMatrix
””  5
,
””5 6
cam
””7 :
.
””: ;
	transform
””; D
.
””D E 
localToWorldMatrix
””E W
)
””W X
;
””X Y
}
‘‘ 
private
÷÷ 
void
÷÷ "
UpdateMaterialParams
÷÷ %
(
÷÷% &
)
÷÷& '
{
÷÷( )
HandleSpheres
◊◊ 
(
◊◊ 
)
◊◊ 
;
◊◊ 
HandleMeshes
ÿÿ 
(
ÿÿ 
)
ÿÿ 
;
ÿÿ 
rayTracingMat
⁄⁄ 
.
⁄⁄ 
SetInt
⁄⁄ 
(
⁄⁄ 
BounceCount
⁄⁄ (
,
⁄⁄( )
MaxBounceCount
⁄⁄* 8
)
⁄⁄8 9
;
⁄⁄9 :
rayTracingMat
€€ 
.
€€ 
SetInt
€€ 
(
€€ 
RaysPerPixel
€€ )
,
€€) *
NumRaysPerPixel
€€+ :
)
€€: ;
;
€€; <
rayTracingMat
‹‹ 
.
‹‹ 
SetInt
‹‹ 
(
‹‹ 
RenderedFrames
‹‹ +
,
‹‹+ ,
NumRenderedFrames
‹‹- >
)
‹‹> ?
;
‹‹? @
rayTracingMat
ﬁﬁ 
.
ﬁﬁ 
SetFloat
ﬁﬁ 
(
ﬁﬁ 
	Intensity
ﬁﬁ (
,
ﬁﬁ( )
SunIntensity
ﬁﬁ* 6
)
ﬁﬁ6 7
;
ﬁﬁ7 8
rayTracingMat
ﬂﬂ 
.
ﬂﬂ 
SetFloat
ﬂﬂ 
(
ﬂﬂ 
Focus
ﬂﬂ $
,
ﬂﬂ$ %
SunFocus
ﬂﬂ& .
)
ﬂﬂ. /
;
ﬂﬂ/ 0
rayTracingMat
·· 
.
·· 
SetFloat
·· 
(
·· 
Strength
·· '
,
··' (
DivergeStrength
··) 8
)
··8 9
;
··9 :
rayTracingMat
‚‚ 
.
‚‚ 
SetFloat
‚‚ 
(
‚‚ 
DefocusStrength1
‚‚ /
,
‚‚/ 0
DefocusStrength
‚‚1 @
)
‚‚@ A
;
‚‚A B
rayTracingMat
„„ 
.
„„ 
SetFloat
„„ 
(
„„ 
Distance
„„ '
,
„„' (
RenderDistance
„„) 7
)
„„7 8
;
„„8 9
rayTracingMat
ÂÂ 
.
ÂÂ 
SetColor
ÂÂ 
(
ÂÂ 
ColorHorizon
ÂÂ +
,
ÂÂ+ ,
SkyColorHorizon
ÂÂ- <
)
ÂÂ< =
;
ÂÂ= >
rayTracingMat
ÊÊ 
.
ÊÊ 
SetColor
ÊÊ 
(
ÊÊ 
ColorZenith
ÊÊ *
,
ÊÊ* +
SkyColorZenith
ÊÊ, :
)
ÊÊ: ;
;
ÊÊ; <
rayTracingMat
ÁÁ 
.
ÁÁ 
SetColor
ÁÁ 
(
ÁÁ 
GroundColor1
ÁÁ +
,
ÁÁ+ ,
GroundColor
ÁÁ- 8
)
ÁÁ8 9
;
ÁÁ9 :
rayTracingMat
ËË 
.
ËË 
SetInt
ËË 
(
ËË 
UseEnvironment
ËË +
,
ËË+ ,
environment
ËË- 8
?
ËË9 :
$num
ËË; <
:
ËË= >
$num
ËË? @
)
ËË@ A
;
ËËA B
}
ÈÈ 
private
ÎÎ 
void
ÎÎ 
HandleSpheres
ÎÎ 
(
ÎÎ 
)
ÎÎ  
{
ÎÎ! "
Sphere
ÏÏ 
[
ÏÏ 
]
ÏÏ 
sphereArray
ÏÏ 
=
ÏÏ 
new
ÏÏ "
Sphere
ÏÏ# )
[
ÏÏ) *
spheres
ÏÏ* 1
.
ÏÏ1 2
Length
ÏÏ2 8
]
ÏÏ8 9
;
ÏÏ9 :
if
ÓÓ 

(
ÓÓ 
spheres
ÓÓ 
.
ÓÓ 
Length
ÓÓ 
==
ÓÓ 
$num
ÓÓ 
)
ÓÓ  
return
ÓÓ! '
;
ÓÓ' (
for
 
(
 
int
 
i
 
=
 
$num
 
;
 
i
 
<
 
spheres
 #
.
# $
Length
$ *
;
* +
i
, -
++
- /
)
/ 0
{
1 2
sphereArray
ÒÒ 
[
ÒÒ 
i
ÒÒ 
]
ÒÒ 
=
ÒÒ 
new
ÒÒ  
Sphere
ÒÒ! '
{
ÒÒ( )
position
ÚÚ 
=
ÚÚ 
spheres
ÚÚ "
[
ÚÚ" #
i
ÚÚ# $
]
ÚÚ$ %
.
ÚÚ% &

gameObject
ÚÚ& 0
.
ÚÚ0 1
	transform
ÚÚ1 :
.
ÚÚ: ;
position
ÚÚ; C
,
ÚÚC D
radius
ÚÚE K
=
ÚÚL M
spheres
ÚÚN U
[
ÚÚU V
i
ÚÚV W
]
ÚÚW X
.
ÚÚX Y

gameObject
ÚÚY c
.
ÚÚc d
	transform
ÚÚd m
.
ÚÚm n

localScale
ÚÚn x
.
ÚÚx y
x
ÚÚy z
/
ÚÚ{ |
$num
ÚÚ} ~
,
ÚÚ~ 
material
ÛÛ 
=
ÛÛ 
spheres
ÛÛ "
[
ÛÛ" #
i
ÛÛ# $
]
ÛÛ$ %
.
ÛÛ% &
material
ÛÛ& .
}
ÙÙ 
;
ÙÙ 
}
ıı 	
sphereReader
˜˜ 
.
˜˜ 
SetData
˜˜ 
(
˜˜ 
sphereArray
˜˜ (
)
˜˜( )
;
˜˜) *
rayTracingMat
¯¯ 
.
¯¯ 
SetInt
¯¯ 
(
¯¯ 
NumOfSpheres
¯¯ )
,
¯¯) *
sphereArray
¯¯+ 6
.
¯¯6 7
Length
¯¯7 =
)
¯¯= >
;
¯¯> ?
rayTracingMat
˘˘ 
.
˘˘ 
	SetBuffer
˘˘ 
(
˘˘  
Spheres
˘˘  '
,
˘˘' (
sphereReader
˘˘) 5
)
˘˘5 6
;
˘˘6 7
}
˙˙ 
private
¸¸ 
void
¸¸ 
HandleMeshes
¸¸ 
(
¸¸ 
)
¸¸ 
{
¸¸  !
foreach
˝˝ 
(
˝˝ 
RayTracingMesh
˝˝ 
mesh
˝˝  $
in
˝˝% '
meshes
˝˝( .
)
˝˝. /
mesh
˝˝0 4
.
˝˝4 5
UpdateMeshData
˝˝5 C
(
˝˝C D
)
˝˝D E
;
˝˝E F
int
ˇˇ 
size
ˇˇ 
=
ˇˇ 
meshes
ˇˇ 
.
ˇˇ 
Sum
ˇˇ 
(
ˇˇ 
mesh
ˇˇ "
=>
ˇˇ# %
mesh
ˇˇ& *
.
ˇˇ* +
	triangles
ˇˇ+ 4
.
ˇˇ4 5
Count
ˇˇ5 :
)
ˇˇ: ;
;
ˇˇ; <
if
ÅÅ 

(
ÅÅ 
size
ÅÅ 
==
ÅÅ 
$num
ÅÅ 
)
ÅÅ 
return
ÅÅ 
;
ÅÅ 
Triangle
ÉÉ 
[
ÉÉ 
]
ÉÉ 
triangleArray
ÉÉ  
=
ÉÉ! "
new
ÉÉ# &
Triangle
ÉÉ' /
[
ÉÉ/ 0
size
ÉÉ0 4
]
ÉÉ4 5
;
ÉÉ5 6
MeshInfo
ÑÑ 
[
ÑÑ 
]
ÑÑ 
	meshInfos
ÑÑ 
=
ÑÑ 
new
ÑÑ "
MeshInfo
ÑÑ# +
[
ÑÑ+ ,
meshes
ÑÑ, 2
.
ÑÑ2 3
Length
ÑÑ3 9
]
ÑÑ9 :
;
ÑÑ: ;
int
ÜÜ 
triangleIndex
ÜÜ 
=
ÜÜ 
$num
ÜÜ 
;
ÜÜ 
for
áá 
(
áá 
int
áá 
i
áá 
=
áá 
$num
áá 
;
áá 
i
áá 
<
áá 
meshes
áá "
.
áá" #
Length
áá# )
;
áá) *
i
áá+ ,
++
áá, .
)
áá. /
{
áá0 1
	meshInfos
àà 
[
àà 
i
àà 
]
àà 
.
àà 
numTriangles
àà %
=
àà& '
meshes
àà( .
[
àà. /
i
àà/ 0
]
àà0 1
.
àà1 2
	triangles
àà2 ;
.
àà; <
Count
àà< A
;
ààA B
	meshInfos
ââ 
[
ââ 
i
ââ 
]
ââ 
.
ââ 
material
ââ !
=
ââ" #
meshes
ââ$ *
[
ââ* +
i
ââ+ ,
]
ââ, -
.
ââ- .
material
ââ. 6
;
ââ6 7
	meshInfos
ää 
[
ää 
i
ää 
]
ää 
.
ää  
firstTriangleIndex
ää +
=
ää, -
triangleIndex
ää. ;
;
ää; <
for
åå 
(
åå 
int
åå 
j
åå 
=
åå 
$num
åå 
;
åå 
j
åå 
<
åå 
meshes
åå  &
[
åå& '
i
åå' (
]
åå( )
.
åå) *
	triangles
åå* 3
.
åå3 4
Count
åå4 9
;
åå9 :
j
åå; <
++
åå< >
)
åå> ?
{
åå@ A
triangleArray
çç 
[
çç 
triangleIndex
çç +
]
çç+ ,
=
çç- .
new
çç/ 2
Triangle
çç3 ;
{
çç< =
posA
éé 
=
éé 
meshes
éé !
[
éé! "
i
éé" #
]
éé# $
.
éé$ %
	triangles
éé% .
[
éé. /
j
éé/ 0
]
éé0 1
.
éé1 2
posA
éé2 6
,
éé6 7
posB
éé8 <
=
éé= >
meshes
éé? E
[
ééE F
i
ééF G
]
ééG H
.
ééH I
	triangles
ééI R
[
ééR S
j
ééS T
]
ééT U
.
ééU V
posB
ééV Z
,
ééZ [
posC
éé\ `
=
ééa b
meshes
ééc i
[
ééi j
i
ééj k
]
éék l
.
éél m
	triangles
éém v
[
éév w
j
ééw x
]
ééx y
.
ééy z
posC
ééz ~
,
éé~ 
normalA
èè 
=
èè 
meshes
èè $
[
èè$ %
i
èè% &
]
èè& '
.
èè' (
	triangles
èè( 1
[
èè1 2
j
èè2 3
]
èè3 4
.
èè4 5
normalA
èè5 <
,
èè< =
normalB
èè> E
=
èèF G
meshes
èèH N
[
èèN O
i
èèO P
]
èèP Q
.
èèQ R
	triangles
èèR [
[
èè[ \
j
èè\ ]
]
èè] ^
.
èè^ _
normalB
èè_ f
,
èèf g
normalC
êê 
=
êê 
meshes
êê $
[
êê$ %
i
êê% &
]
êê& '
.
êê' (
	triangles
êê( 1
[
êê1 2
j
êê2 3
]
êê3 4
.
êê4 5
normalC
êê5 <
}
ëë 
;
ëë 
triangleIndex
ìì 
++
ìì 
;
ìì  
}
îî 
}
ïï 	
triangleReader
óó 
.
óó 
SetData
óó 
(
óó 
triangleArray
óó ,
)
óó, -
;
óó- .

meshReader
òò 
.
òò 
SetData
òò 
(
òò 
	meshInfos
òò $
)
òò$ %
;
òò% &
rayTracingMat
öö 
.
öö 
SetInt
öö 
(
öö 
	NumMeshes
öö &
,
öö& '
	meshInfos
öö( 1
.
öö1 2
Length
öö2 8
)
öö8 9
;
öö9 :
rayTracingMat
õõ 
.
õõ 
	SetBuffer
õõ 
(
õõ  
	Triangles
õõ  )
,
õõ) *
triangleReader
õõ+ 9
)
õõ9 :
;
õõ: ;
rayTracingMat
úú 
.
úú 
	SetBuffer
úú 
(
úú  
AllMeshInfo
úú  +
,
úú+ ,

meshReader
úú- 7
)
úú7 8
;
úú8 9
}
ùù 
private
üü 
struct
üü 
Sphere
üü 
{
üü 
public
†† 
Vector3
†† 
position
†† 
;
††  
public
°° 
float
°° 
radius
°° 
;
°° 
public
¢¢  
RayTracingMaterial
¢¢ !
material
¢¢" *
;
¢¢* +
}
££ 
private
•• 
struct
•• 
Triangle
•• 
{
•• 
public
¶¶ 
Vector3
¶¶ 
posA
¶¶ 
,
¶¶ 
posB
¶¶ !
,
¶¶! "
posC
¶¶# '
;
¶¶' (
public
ßß 
Vector3
ßß 
normalA
ßß 
,
ßß 
normalB
ßß  '
,
ßß' (
normalC
ßß) 0
;
ßß0 1
}
®® 
private
™™ 
struct
™™ 
MeshInfo
™™ 
{
™™ 
public
´´ 
int
´´  
firstTriangleIndex
´´ %
;
´´% &
public
¨¨ 
int
¨¨ 
numTriangles
¨¨ 
;
¨¨  
public
≠≠  
RayTracingMaterial
≠≠ !
material
≠≠" *
;
≠≠* +
}
ÆÆ 
}ØØ 