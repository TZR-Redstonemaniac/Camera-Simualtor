±>
mC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Tests\IntersectionTester.cs
public 
class 
IntersectionTester 
:  !
MonoBehaviour" /
{0 1
[ 
Header 
( 
$str 
) 
] 
[ 
SerializeField &
]& '
private( /
Vector20 7
pos8 ;
;; <
[ 
SerializeField 
] 
private 
float "
rad# &
;& '
[		 
Header		 
(		 
$str		 
)		 
]		 
[		 
SerializeField		 (
]		( )
private		* 1
Vector2		2 9
	positionA		: C
;		C D
[ 
SerializeField 
] 
private 
Vector2 $
	positionB% .
;. /
[ 
SerializeField 
] 
private 
Vector2 $
	positionC% .
;. /
[ 
Header 
( 
$str 
) 
] 
[ 
SerializeField &
]& '
private( /
Camera0 6
cam7 :
;: ;
[ 
SerializeField 
] 
private 
float "
rayLen# )
;) *
private 
void 
Update 
( 
) 
{ 
Vector3 
mousePos 
= 
cam 
. 
ScreenToWorldPoint 1
(1 2
new2 5
Vector36 =
(= >
Input> C
.C D
mousePositionD Q
.Q R
xR S
,S T
InputU Z
.Z [
mousePosition[ h
.h i
yi j
,j k
cam 
. 
	transform 
. 
position "
." #
z# $
*% &
-' (
$num( )
)) *
)* +
;+ ,
float 
dir 
= 
MovementHelper "
." #
GetAngleInDegrees# 4
(4 5
pos5 8
,8 9
mousePos: B
)B C
;C D
Vector2 
	vectorDir 
= 
new 
(  
Mathf  %
.% &
Sin& )
() *
dir* -
*. /
Mathf0 5
.5 6
Deg2Rad6 =
)= >
,> ?
Mathf@ E
.E F
CosF I
(I J
dirJ M
*N O
MathfP U
.U V
Deg2RadV ]
)] ^
)^ _
;_ `
Vector2 
endPos 
= 
pos 
+ 
	vectorDir (
*) *
rayLen+ 1
;1 2
using 
( 
Draw 
. 
Command 
( 
cam 
)  
)  !
{" #
Draw 
. 
LineGeometry 
= 
LineGeometry  ,
., -
Volumetric3D- 9
;9 :
Draw 
. 
ThicknessSpace 
=  !
ThicknessSpace" 0
.0 1
Pixels1 7
;7 8
Draw 
. 
	Thickness 
= 
$num 
; 
Draw 
. 
Line 
( 
pos 
, 
endPos !
,! "
Color# (
.( )
gray) -
,- .
Color/ 4
.4 5
gray5 9
)9 :
;: ;
Draw!! 
.!! 
Triangle!! 
(!! 
	positionA!! #
,!!# $
	positionB!!% .
,!!. /
	positionC!!0 9
,!!9 :
Color!!; @
.!!@ A
white!!A F
)!!F G
;!!G H
Draw"" 
."" 
Disc"" 
("" 
pos"" 
,"" 
rad"" 
,"" 

DiscColors""  *
.""* +
Flat""+ /
(""/ 0
Color""0 5
.""5 6
white""6 ;
)""; <
)""< =
;""= >
}## 	
DoesIntersect%% 
(%% 
	vectorDir%% 
)%%  
;%%  !
}&& 
private(( 
void(( 
DoesIntersect(( 
((( 
Vector2(( &
dir((' *
)((* +
{((, -
Vector3)) 
edgeAB)) 
=)) 
	positionB)) "
-))# $
	positionA))% .
;)). /
Vector3** 
edgeAC** 
=** 
	positionC** "
-**# $
	positionA**% .
;**. /
Vector3++ 
normalVector++ 
=++ 
Vector3++ &
.++& '
Cross++' ,
(++, -
edgeAB++- 3
,++3 4
edgeAC++5 ;
)++; <
;++< =
Vector3,, 
ao,, 
=,, 
pos,, 
-,, 
	positionA,, $
;,,$ %
Vector3-- 
dao-- 
=-- 
Vector3-- 
.-- 
Cross-- #
(--# $
ao--$ &
,--& '
dir--( +
)--+ ,
;--, -
float// 
determinant// 
=// 
-// 
Vector3// $
.//$ %
Dot//% (
(//( )
dir//) ,
,//, -
normalVector//. :
)//: ;
;//; <
float00 
invDet00 
=00 
$num00 
/00 
determinant00 &
;00& '
float22 
dst22 
=22 
Vector322 
.22 
Dot22 
(22  
ao22  "
,22" #
normalVector22$ 0
)220 1
*222 3
invDet224 :
;22: ;
float33 
u33 
=33 
Vector333 
.33 
Dot33 
(33 
edgeAC33 $
,33$ %
dao33& )
)33) *
*33+ ,
invDet33- 3
;333 4
float44 
v44 
=44 
-44 
Vector344 
.44 
Dot44 
(44 
edgeAB44 %
,44% &
dao44' *
)44* +
*44, -
invDet44. 4
;444 5
float55 
w55 
=55 
$num55 
-55 
u55 
-55 
v55 
;55 
Debug77 
.77 
Log77 
(77 
normalVector77 
+77  
$str77! %
+77& '
dir77( +
)77+ ,
;77, -
if99 

(99 
determinant99 
<99 
$num99 
||99 !
dst99" %
<99& '
$num99( )
||99* ,
u99- .
<99/ 0
$num991 2
||993 5
v996 7
<998 9
$num99: ;
||99< >
w99? @
<99A B
$num99C D
)99D E
return99F L
;99L M
Vector3;; 
p1;; 
=;; 
pos;; 
+;; 
dir;; 
*;;  
dst;;! $
;;;$ %
using== 
(== 
Draw== 
.== 
Command== 
(== 
cam== 
)==  
)==  !
Draw==" &
.==& '
Disc==' +
(==+ ,
p1==, .
,==. /
rad==0 3
,==3 4

DiscColors==5 ?
.==? @
Flat==@ D
(==D E
Color==E J
.==J K
red==K N
)==N O
)==O P
;==P Q
}>> 
}?? ¯4
kC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Objects\RayTracingMesh.cs
[ 
ExecuteAlways 
] 
public 
class 
RayTracingMesh 
: 
MonoBehaviour +
{, -
private 
static 
readonly 
int 

Glossiness  *
=+ ,
Shader- 3
.3 4
PropertyToID4 @
(@ A
$strA N
)N O
;O P
public 

RayTracingMaterial 
material &
;& '
public

 

readonly

 
List

 
<

 
Triangle

 !
>

! "
	triangles

# ,
=

- .
new

/ 2
(

2 3
)

3 4
;

4 5
private 
Material 
mat 
; 
private 
Mesh 
mesh 
; 
private 
void 
Start 
( 
) 
=> 
UpdateMeshData *
(* +
)+ ,
;, -
private 
void 
Update 
( 
) 
{ 
if 

( 
mat 
== 
null 
) 
mat 
= 
new "
Material# +
(+ ,
Shader, 2
.2 3
Find3 7
(7 8
$str8 B
)B C
)C D
;D E
mat 
. 
color 
= 
material 
. 
color "
;" #
mat 
. 
SetFloat 
( 

Glossiness 
,  
material! )
.) *

smoothness* 4
)4 5
;5 6
GetComponent 
< 
MeshRenderer !
>! "
(" #
)# $
.$ %
material% -
=. /
mat0 3
;3 4
} 
public 

void 
UpdateMeshData 
( 
)  
{! "
	triangles 
. 
Clear 
( 
) 
; 
mesh 
= 
GetComponent 
< 

MeshFilter &
>& '
(' (
)( )
.) *

sharedMesh* 4
;4 5
Vector3 
[ 
] 
vertices 
= 
mesh !
.! "
vertices" *
;* +
Vector3 
[ 
] 
normals 
= 
mesh  
.  !
normals! (
;( )
int 
[ 
] 
indices 
= 
mesh 
. 
	triangles &
;& '
Triangle!! 
triangle!! 
=!! 
new!! 
(!!  
)!!  !
;!!! "
for"" 
("" 
int"" 
i"" 
="" 
$num"" 
;"" 
i"" 
<"" 
indices"" #
.""# $
Length""$ *
;""* +
i"", -
+="". 0
$num""1 2
)""2 3
{""4 5
int## 
a## 
=## 
indices## 
[## 
i## 
]## 
;## 
int$$ 
b$$ 
=$$ 
indices$$ 
[$$ 
i$$ 
+$$ 
$num$$  !
]$$! "
;$$" #
int%% 
c%% 
=%% 
indices%% 
[%% 
i%% 
+%% 
$num%%  !
]%%! "
;%%" #
triangle'' 
.'' 
posA'' 
='' 
LocalToWorld'' (
(''( )
vertices'') 1
[''1 2
a''2 3
]''3 4
)''4 5
;''5 6
triangle(( 
.(( 
normalA(( 
=(( 
normals(( &
[((& '
a((' (
]((( )
;(() *
triangle** 
.** 
posB** 
=** 
LocalToWorld** (
(**( )
vertices**) 1
[**1 2
b**2 3
]**3 4
)**4 5
;**5 6
triangle++ 
.++ 
normalB++ 
=++ 
normals++ &
[++& '
b++' (
]++( )
;++) *
triangle-- 
.-- 
posC-- 
=-- 
LocalToWorld-- (
(--( )
vertices--) 1
[--1 2
c--2 3
]--3 4
)--4 5
;--5 6
triangle.. 
... 
normalC.. 
=.. 
normals.. &
[..& '
c..' (
]..( )
;..) *
	triangles// 
.// 
Add// 
(// 
triangle// "
)//" #
;//# $
triangle00 
=00 
new00 
Triangle00 #
(00# $
)00$ %
;00% &
}11 	
}22 
private44 
Vector344 
LocalToWorld44  
(44  !
Vector344! (
vertex44) /
)44/ 0
{441 2
Vector355 
objectPosition55 
=55  
	transform55! *
.55* +
position55+ 3
;553 4

Quaternion66 
objectRotation66 !
=66" #
	transform66$ -
.66- .
rotation66. 6
;666 7
Vector377 
objectScale77 
=77 
	transform77 '
.77' (

lossyScale77( 2
;772 3
Vector3:: 
scaledVertex:: 
=:: 
Vector3:: &
.::& '
Scale::' ,
(::, -
vertex::- 3
,::3 4
objectScale::5 @
)::@ A
;::A B
Vector3== 
rotatedVertex== 
=== 
objectRotation==  .
*==/ 0
scaledVertex==1 =
;=== >
Vector3@@ 
worldVertex@@ 
=@@ 
objectPosition@@ ,
+@@- .
rotatedVertex@@/ <
;@@< =
returnBB 
worldVertexBB 
;BB 
}CC 
publicEE 

structEE 
TriangleEE 
{EE 
publicFF 
Vector3FF 
posAFF 
,FF 
posBFF !
,FF! "
posCFF# '
;FF' (
publicGG 
Vector3GG 
normalAGG 
,GG 
normalBGG  '
,GG' (
normalCGG) 0
;GG0 1
}HH 
}II ã∂
fC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\RayTracingManager.cs
[ 
ExecuteAlways 
] 
[		 )
ImageEffectAllowedInSceneView		 
]		 
public

 
class

 
RayTracingManager

 
:

  
MonoBehaviour

! .
{

/ 0
private 
static 
readonly 
int 
Spheres  '
=( )
Shader* 0
.0 1
PropertyToID1 =
(= >
$str> G
)G H
;H I
private 
static 
readonly 
int 
	Triangles  )
=* +
Shader, 2
.2 3
PropertyToID3 ?
(? @
$str@ K
)K L
;L M
private 
static 
readonly 
int 
AllMeshInfo  +
=, -
Shader. 4
.4 5
PropertyToID5 A
(A B
$strB O
)O P
;P Q
private 
static 
readonly 
int 
NumOfSpheres  ,
=- .
Shader/ 5
.5 6
PropertyToID6 B
(B C
$strC Q
)Q R
;R S
private 
static 
readonly 
int 
BounceCount  +
=, -
Shader. 4
.4 5
PropertyToID5 A
(A B
$strB R
)R S
;S T
private 
static 
readonly 
int 
RaysPerPixel  ,
=- .
Shader/ 5
.5 6
PropertyToID6 B
(B C
$strC T
)T U
;U V
private 
static 
readonly 
int 
RenderedFrames  .
=/ 0
Shader1 7
.7 8
PropertyToID8 D
(D E
$strE X
)X Y
;Y Z
private 
static 
readonly 
int 
	Intensity  )
=* +
Shader, 2
.2 3
PropertyToID3 ?
(? @
$str@ N
)N O
;O P
private 
static 
readonly 
int 
Focus  %
=& '
Shader( .
.. /
PropertyToID/ ;
(; <
$str< F
)F G
;G H
private 
static 
readonly 
int 
ColorHorizon  ,
=- .
Shader/ 5
.5 6
PropertyToID6 B
(B C
$strC T
)T U
;U V
private 
static 
readonly 
int 
ColorZenith  +
=, -
Shader. 4
.4 5
PropertyToID5 A
(A B
$strB R
)R S
;S T
private 
static 
readonly 
int 
GroundColor1  ,
=- .
Shader/ 5
.5 6
PropertyToID6 B
(B C
$strC P
)P Q
;Q R
private 
static 
readonly 
int 

ViewParams  *
=+ ,
Shader- 3
.3 4
PropertyToID4 @
(@ A
$strA M
)M N
;N O
private 
static 
readonly 
int !
CamLocalToWorldMatrix  5
=6 7
Shader8 >
.> ?
PropertyToID? K
(K L
$strL c
)c d
;d e
private 
static 
readonly 
int 
Frames  &
=' (
Shader) /
./ 0
PropertyToID0 <
(< =
$str= Q
)Q R
;R S
private 
static 
readonly 
int 
	PrevFrame  )
=* +
Shader, 2
.2 3
PropertyToID3 ?
(? @
$str@ L
)L M
;M N
private 
static 
readonly 
int 
	NumMeshes  )
=* +
Shader, 2
.2 3
PropertyToID3 ?
(? @
$str@ K
)K L
;L M
private 
static 
readonly 
int 
UseEnvironment  .
=/ 0
Shader1 7
.7 8
PropertyToID8 D
(D E
$strE U
)U V
;V W
private 
static 
readonly 
int 
Strength  (
=) *
Shader+ 1
.1 2
PropertyToID2 >
(> ?
$str? P
)P Q
;Q R
private 
static 
readonly 
int 
DefocusStrength1  0
=1 2
Shader3 9
.9 :
PropertyToID: F
(F G
$strG X
)X Y
;Y Z
[!! 
Header!! 
(!! 
$str!! 
)!! 
]!! 
["" 
SerializeField"" 
]"" 
private"" 
Shader"" #
rayTracingShader""$ 4
;""4 5
[$$ 
SerializeField$$ 
]$$ 
private$$ 
Shader$$ #
companionShader$$$ 3
;$$3 4
[%% 
SerializeField%% 
]%% 
private%% 
Camera%% #
mainCam%%$ +
;%%+ ,
['' 
Header'' 
('' 
$str'' 
)'' 
]'' 
[(( 
SerializeField(( 
](( 
private(( 
bool(( ! 
useShaderInSceneView((" 6
;((6 7
[** 
SerializeField** 
]** 
[** 
Range** 
(** 
$num** 
,** 
$num** !
)**! "
]**" #
private**$ +
int**, /
MaxBounceCount**0 >
;**> ?
[++ 
SerializeField++ 
]++ 
[++ 
Range++ 
(++ 
$num++ 
,++ 
$num++ !
)++! "
]++" #
private++$ +
int++, /
NumRaysPerPixel++0 ?
;++? @
[,, 
SerializeField,, 
],, 
[,, 
Min,, 
(,, 
$num,, 
),, 
],, 
private,, %
float,,& +
DivergeStrength,,, ;
;,,; <
[-- 
SerializeField-- 
]-- 
[-- 
Min-- 
(-- 
$num-- 
)-- 
]-- 
private-- %
float--& +
DefocusStrength--, ;
;--; <
[.. 
SerializeField.. 
].. 
[.. 
Min.. 
(.. 
$num.. 
).. 
]..  
private..! (
float..) .
FocusDistance../ <
;..< =
[// 
SerializeField// 
]// 
[// 
Min// 
(// 
$num// 
)// 
]//  
private//! (
float//) .
RenderDistance/// =
;//= >
[11 
Header11 
(11 
$str11 
)11 
]11 
[22 
SerializeField22 
]22 
private22 
bool22 !
environment22" -
;22- .
[44 
SerializeField44 
]44 
private44 
bool44 !
visualizeFocus44" 0
;440 1
[66 
SerializeField66 
]66 
private66 
Color66 "
SkyColorHorizon66# 2
;662 3
[77 
SerializeField77 
]77 
private77 
Color77 "
SkyColorZenith77# 1
;771 2
[88 
SerializeField88 
]88 
private88 
Color88 "
GroundColor88# .
;88. /
[99 
SerializeField99 
]99 
private99 
float99 "
SunFocus99# +
;99+ ,
[:: 
SerializeField:: 
]:: 
private:: 
float:: "
SunIntensity::# /
;::/ 0
private<< 
Material<< 
companionMat<< !
;<<! "
private>> 
RenderTexture>> 
currentTexture>> (
;>>( )
private@@ 
bool@@ 
init@@ 
;@@ 
privateAA 
RayTracingMeshAA 
[AA 
]AA 
meshesAA #
;AA# $
privateBB 
ComputeBufferBB 

meshReaderBB $
;BB$ %
privateDD 
intDD 
NumRenderedFramesDD !
;DD! "
privateFF 
MaterialFF 
rayTracingMatFF "
;FF" #
privateHH 
ComputeBufferHH 
sphereReaderHH &
;HH& '
privateJJ 
SphereObjectJJ 
[JJ 
]JJ 
spheresJJ "
;JJ" #
privateKK 
ComputeBufferKK 
triangleReaderKK (
;KK( )
privateLL 
staticLL 
readonlyLL 
intLL 
DistanceLL  (
=LL) *
ShaderLL+ 1
.LL1 2
PropertyToIDLL2 >
(LL> ?
$strLL? O
)LLO P
;LLP Q
privateNN 
voidNN 
StartNN 
(NN 
)NN 
=>NN 
InitShadersNN '
(NN' (
)NN( )
;NN) *
privatePP 
voidPP 
	OnDestroyPP 
(PP 
)PP 
{PP 

meshReaderQQ 
?QQ 
.QQ 
ReleaseQQ 
(QQ 
)QQ 
;QQ 
sphereReaderRR 
?RR 
.RR 
ReleaseRR 
(RR 
)RR 
;RR  
triangleReaderSS 
?SS 
.SS 
ReleaseSS 
(SS  
)SS  !
;SS! "

meshReaderTT 
?TT 
.TT 
DisposeTT 
(TT 
)TT 
;TT 
sphereReaderUU 
?UU 
.UU 
DisposeUU 
(UU 
)UU 
;UU  
triangleReaderVV 
?VV 
.VV 
DisposeVV 
(VV  
)VV  !
;VV! "
}WW 
privateYY 
voidYY 
OnRenderImageYY 
(YY 
RenderTextureYY ,
srcYY- 0
,YY0 1
RenderTextureYY2 ?
targetYY@ F
)YYF G
{YYH I
ifZZ 

(ZZ 
!ZZ 
initZZ 
)ZZ 
InitZZ 
(ZZ 
srcZZ 
)ZZ 
;ZZ 
if\\ 

(\\ 
visualizeFocus\\ 
)\\ 
{\\ 
Camera]] 
cam]] 
=]]  
useShaderInSceneView]] -
?]]. /
Camera]]0 6
.]]6 7
current]]7 >
:]]? @
mainCam]]A H
;]]H I
float__ 
frustumHeight__ 
=__  !
$num__" &
*__' (
Mathf__) .
.__. /
Tan__/ 2
(__2 3
cam__3 6
.__6 7
fieldOfView__7 B
*__C D
$num__E I
*__J K
Mathf__L Q
.__Q R
Deg2Rad__R Y
)__Y Z
*__[ \
FocusDistance__] j
;__j k
float`` 
frustumWidth`` 
=``  
frustumHeight``! .
*``/ 0
cam``1 4
.``4 5
aspect``5 ;
;``; <
Vector3bb 
topLeftFrustumLinebb &
=bb' (
cambb) ,
.bb, -
	transformbb- 6
.bb6 7
positionbb7 ?
+bb@ A
cambbB E
.bbE F
	transformbbF O
.bbO P
rightbbP U
*bbV W
(bbX Y
-bbY Z
frustumWidthbbZ f
*bbg h
$numbbi m
)bbm n
+bbo p
camcc 
.cc 
	transformcc 
.cc 
upcc  
*cc! "
(cc# $
frustumHeightcc$ 1
*cc2 3
$numcc4 8
)cc8 9
+cc: ;
camcc< ?
.cc? @
	transformcc@ I
.ccI J
forwardccJ Q
*ccR S
FocusDistanceccT a
;cca b
Vector3ee 
topRightFrustumLineee '
=ee( )
camee* -
.ee- .
	transformee. 7
.ee7 8
positionee8 @
+eeA B
cameeC F
.eeF G
	transformeeG P
.eeP Q
righteeQ V
*eeW X
(eeY Z
frustumWidtheeZ f
*eeg h
$numeei m
)eem n
+eeo p
camff 
.ff 
	transformff 
.ff 
upff  
*ff! "
(ff# $
frustumHeightff$ 1
*ff2 3
$numff4 8
)ff8 9
+ff: ;
camff< ?
.ff? @
	transformff@ I
.ffI J
forwardffJ Q
*ffR S
FocusDistanceffT a
;ffa b
Vector3hh "
bottomRightFrustumLinehh *
=hh+ ,
camhh- 0
.hh0 1
	transformhh1 :
.hh: ;
positionhh; C
+hhD E
camhhF I
.hhI J
	transformhhJ S
.hhS T
righthhT Y
*hhZ [
(hh\ ]
frustumWidthhh] i
*hhj k
$numhhl p
)hhp q
-hhr s
camii 
.ii 
	transformii 
.ii 
upii  
*ii! "
(ii# $
frustumHeightii$ 1
*ii2 3
$numii4 8
)ii8 9
+ii: ;
camii< ?
.ii? @
	transformii@ I
.iiI J
forwardiiJ Q
*iiR S
FocusDistanceiiT a
;iia b
Vector3kk !
bottomLeftFrustumLinekk )
=kk* +
camkk, /
.kk/ 0
	transformkk0 9
.kk9 :
positionkk: B
+kkC D
camkkE H
.kkH I
	transformkkI R
.kkR S
rightkkS X
*kkY Z
(kk[ \
-kk\ ]
frustumWidthkk] i
*kkj k
$numkkl p
)kkp q
-kkr s
camll 
.ll 
	transformll 
.ll 
upll  
*ll! "
(ll# $
frustumHeightll$ 1
*ll2 3
$numll4 8
)ll8 9
+ll: ;
camll< ?
.ll? @
	transformll@ I
.llI J
forwardllJ Q
*llR S
FocusDistancellT a
;lla b
ifnn 
(nn 
Camerann 
.nn 
currentnn 
.nn 
namenn #
==nn$ &
$strnn' 4
)nn4 5
{nn6 7
usingoo 
(oo 
Drawoo 
.oo 
Commandoo #
(oo# $
Cameraoo$ *
.oo* +
currentoo+ 2
)oo2 3
)oo3 4
{oo5 6
Colorpp 
colorpp 
=pp  !
Colorpp" '
.pp' (
greenpp( -
;pp- .
colorqq 
.qq 
aqq 
=qq 
$numqq #
;qq# $
Drawrr 
.rr 
Quadrr 
(rr 
topRightFrustumLinerr 1
,rr1 2
topLeftFrustumLinerr3 E
,rrE F!
bottomLeftFrustumLinerrG \
,rr\ ]"
bottomRightFrustumLinerr^ t
,rrt u
colorrrv {
)rr{ |
;rr| }
}ss 
}tt 
}uu 	
ifww 

(ww  
useShaderInSceneViewww  
&&ww! #
!ww$ %
Applicationww% 0
.ww0 1
	isPlayingww1 :
)ww: ;
{ww< =
InitShadersxx 
(xx 
)xx 
;xx 
UpdateCameraParamszz 
(zz 
Camerazz %
.zz% &
currentzz& -
)zz- .
;zz. / 
UpdateMaterialParams{{  
({{  !
){{! "
;{{" #
Graphics}} 
.}} 
Blit}} 
(}} 
null}} 
,}} 
target}}  &
,}}& '
rayTracingMat}}( 5
)}}5 6
;}}6 7
}~~ 	
else~~
 
if~~ 
(~~ 
Camera~~ 
.~~ 
current~~ !
.~~! "
name~~" &
!=~~' )
$str~~* 7
)~~7 8
{~~9 :
InitShaders 
( 
) 
;  
UpdateCameraParams
ÅÅ 
(
ÅÅ 
Camera
ÅÅ %
.
ÅÅ% &
current
ÅÅ& -
)
ÅÅ- .
;
ÅÅ. /"
UpdateMaterialParams
ÇÇ  
(
ÇÇ  !
)
ÇÇ! "
;
ÇÇ" #
RenderTexture
ÑÑ 
prevFrameCopy
ÑÑ '
=
ÑÑ( )
RenderTexture
ÑÑ* 7
.
ÑÑ7 8
GetTemporary
ÑÑ8 D
(
ÑÑD E
src
ÑÑE H
.
ÑÑH I
width
ÑÑI N
,
ÑÑN O
src
ÑÑP S
.
ÑÑS T
height
ÑÑT Z
,
ÑÑZ [
$num
ÑÑ\ ]
,
ÑÑ] ^
GraphicsFormat
ÑÑ_ m
.
ÑÑm n"
R32G32B32A32_SFloatÑÑn Å
)ÑÑÅ Ç
;ÑÑÇ É
Graphics
ÖÖ 
.
ÖÖ 
Blit
ÖÖ 
(
ÖÖ 
currentTexture
ÖÖ (
,
ÖÖ( )
prevFrameCopy
ÖÖ* 7
)
ÖÖ7 8
;
ÖÖ8 9
NumRenderedFrames
áá 
+=
áá  
Application
áá! ,
.
áá, -
	isPlaying
áá- 6
?
áá7 8
$num
áá9 :
:
áá; <
$num
áá= >
;
áá> ?"
UpdateMaterialParams
àà  
(
àà  !
)
àà! "
;
àà" #
RenderTexture
ââ 
currentFrame
ââ &
=
ââ' (
RenderTexture
ââ) 6
.
ââ6 7
GetTemporary
ââ7 C
(
ââC D
src
ââD G
.
ââG H
width
ââH M
,
ââM N
src
ââO R
.
ââR S
height
ââS Y
,
ââY Z
$num
ââ[ \
,
ââ\ ]
GraphicsFormat
ââ^ l
.
ââl m"
R32G32B32A32_SFloatââm Ä
)ââÄ Å
;ââÅ Ç
Graphics
ää 
.
ää 
Blit
ää 
(
ää 
null
ää 
,
ää 
currentFrame
ää  ,
,
ää, -
rayTracingMat
ää. ;
)
ää; <
;
ää< =
companionMat
åå 
.
åå 
SetInt
åå 
(
åå  
Frames
åå  &
,
åå& '
NumRenderedFrames
åå( 9
)
åå9 :
;
åå: ;
companionMat
çç 
.
çç 

SetTexture
çç #
(
çç# $
	PrevFrame
çç$ -
,
çç- .
prevFrameCopy
çç/ <
)
çç< =
;
çç= >
Graphics
éé 
.
éé 
Blit
éé 
(
éé 
currentFrame
éé &
,
éé& '
currentTexture
éé( 6
,
éé6 7
companionMat
éé8 D
)
ééD E
;
ééE F
Graphics
êê 
.
êê 
Blit
êê 
(
êê 
currentTexture
êê (
,
êê( )
target
êê* 0
)
êê0 1
;
êê1 2
RenderTexture
íí 
.
íí 
ReleaseTemporary
íí *
(
íí* +
currentFrame
íí+ 7
)
íí7 8
;
íí8 9
RenderTexture
ìì 
.
ìì 
ReleaseTemporary
ìì *
(
ìì* +
prevFrameCopy
ìì+ 8
)
ìì8 9
;
ìì9 :
RenderTexture
îî 
.
îî 
ReleaseTemporary
îî *
(
îî* +
currentFrame
îî+ 7
)
îî7 8
;
îî8 9
}
ïï 	
else
ïï
 
Graphics
ïï 
.
ïï 
Blit
ïï 
(
ïï 
src
ïï  
,
ïï  !
target
ïï" (
)
ïï( )
;
ïï) *
}
ññ 
private
òò 
void
òò 
InitShaders
òò 
(
òò 
)
òò 
{
òò  
rayTracingMat
ôô 
=
ôô 
new
ôô 
Material
ôô $
(
ôô$ %
rayTracingShader
ôô% 5
)
ôô5 6
;
ôô6 7
companionMat
öö 
=
öö 
new
öö 
Material
öö #
(
öö# $
companionShader
öö$ 3
)
öö3 4
;
öö4 5

meshReader
úú 
?
úú 
.
úú 
Release
úú 
(
úú 
)
úú 
;
úú 
sphereReader
ùù 
?
ùù 
.
ùù 
Release
ùù 
(
ùù 
)
ùù 
;
ùù  
triangleReader
ûû 
?
ûû 
.
ûû 
Release
ûû 
(
ûû  
)
ûû  !
;
ûû! "

meshReader
üü 
?
üü 
.
üü 
Dispose
üü 
(
üü 
)
üü 
;
üü 
sphereReader
†† 
?
†† 
.
†† 
Dispose
†† 
(
†† 
)
†† 
;
††  
triangleReader
°° 
?
°° 
.
°° 
Dispose
°° 
(
°°  
)
°°  !
;
°°! "
meshes
££ 
=
££ 
FindObjectsOfType
££ "
<
££" #
RayTracingMesh
££# 1
>
££1 2
(
££2 3
)
££3 4
;
££4 5
foreach
§§ 
(
§§ 
RayTracingMesh
§§ 
mesh
§§  $
in
§§% '
meshes
§§( .
)
§§. /
mesh
§§0 4
.
§§4 5
UpdateMeshData
§§5 C
(
§§C D
)
§§D E
;
§§E F
int
•• 
size
•• 
=
•• 
meshes
•• 
.
•• 
Sum
•• 
(
•• 
mesh
•• "
=>
••# %
mesh
••& *
.
••* +
	triangles
••+ 4
.
••4 5
Count
••5 :
)
••: ;
;
••; <
if
ßß 

(
ßß 
size
ßß 
>
ßß 
$num
ßß 
)
ßß 
{
ßß 
const
®® 
int
®® 
triangleSize
®® "
=
®®# $
sizeof
®®% +
(
®®+ ,
float
®®, 1
)
®®1 2
*
®®3 4
$num
®®5 7
;
®®7 8
const
©© 
int
©© 
meshSize
©© 
=
©©  
sizeof
©©! '
(
©©' (
float
©©( -
)
©©- .
*
©©/ 0
$num
©©1 3
+
©©4 5
sizeof
©©6 <
(
©©< =
int
©©= @
)
©©@ A
*
©©B C
$num
©©D E
;
©©E F
triangleReader
™™ 
=
™™ 
new
™™  
ComputeBuffer
™™! .
(
™™. /
size
™™/ 3
,
™™3 4
triangleSize
™™5 A
)
™™A B
;
™™B C

meshReader
´´ 
=
´´ 
new
´´ 
ComputeBuffer
´´ *
(
´´* +
meshes
´´+ 1
.
´´1 2
Length
´´2 8
,
´´8 9
meshSize
´´: B
)
´´B C
;
´´C D
}
¨¨ 	
spheres
ÆÆ 
=
ÆÆ 
FindObjectsOfType
ÆÆ #
<
ÆÆ# $
SphereObject
ÆÆ$ 0
>
ÆÆ0 1
(
ÆÆ1 2
)
ÆÆ2 3
;
ÆÆ3 4
if
∞∞ 

(
∞∞ 
spheres
∞∞ 
.
∞∞ 
Length
∞∞ 
>
∞∞ 
$num
∞∞ 
)
∞∞ 
{
∞∞  !
const
±± 
int
±± 

sphereSize
±±  
=
±±! "
sizeof
±±# )
(
±±) *
float
±±* /
)
±±/ 0
*
±±1 2
$num
±±3 5
;
±±5 6
sphereReader
≤≤ 
=
≤≤ 
new
≤≤ 
ComputeBuffer
≤≤ ,
(
≤≤, -
spheres
≤≤- 4
.
≤≤4 5
Length
≤≤5 ;
,
≤≤; <

sphereSize
≤≤= G
)
≤≤G H
;
≤≤H I
}
≥≥ 	
}
¥¥ 
private
∂∂ 
void
∂∂ 
Init
∂∂ 
(
∂∂ 
RenderTexture
∂∂ #
src
∂∂$ '
)
∂∂' (
{
∂∂) *
int
∑∑ 
width
∑∑ 
=
∑∑ 
src
∑∑ 
.
∑∑ 
width
∑∑ 
;
∑∑ 
int
∏∏ 
height
∏∏ 
=
∏∏ 
src
∏∏ 
.
∏∏ 
height
∏∏ 
;
∏∏  
int
ππ 
	depthMode
ππ 
=
ππ 
src
ππ 
.
ππ 
depth
ππ !
;
ππ! "
GraphicsFormat
ªª 
format
ªª 
=
ªª 
src
ªª  #
.
ªª# $
graphicsFormat
ªª$ 2
;
ªª2 3
bool
ΩΩ 

useMipMaps
ΩΩ 
=
ΩΩ 
src
ΩΩ 
.
ΩΩ 
	useMipMap
ΩΩ '
;
ΩΩ' (
currentTexture
øø 
=
øø 
new
øø 
RenderTexture
øø *
(
øø* +
width
øø+ 0
,
øø0 1
height
øø2 8
,
øø8 9
	depthMode
øø: C
)
øøC D
{
øøE F
graphicsFormat
¿¿ 
=
¿¿ 
format
¿¿ #
,
¿¿# $
enableRandomWrite
¿¿% 6
=
¿¿7 8
true
¿¿9 =
,
¿¿= >
autoGenerateMips
¿¿? O
=
¿¿P Q
false
¿¿R W
,
¿¿W X
	useMipMap
¿¿Y b
=
¿¿c d

useMipMaps
¿¿e o
}
¡¡ 	
;
¡¡	 

currentTexture
√√ 
.
√√ 
Create
√√ 
(
√√ 
)
√√ 
;
√√  
init
≈≈ 
=
≈≈ 
true
≈≈ 
;
≈≈ 
}
∆∆ 
private
»» 
void
»»  
UpdateCameraParams
»» #
(
»»# $
Camera
»»$ *
cam
»»+ .
)
»». /
{
»»0 1
rayTracingMat
…… 
=
…… 
new
…… 
Material
…… $
(
……$ %
rayTracingShader
……% 5
)
……5 6
;
……6 7
companionMat
   
=
   
new
   
Material
   #
(
  # $
companionShader
  $ 3
)
  3 4
;
  4 5
float
ÃÃ 
planeHeight
ÃÃ 
=
ÃÃ 
FocusDistance
ÃÃ )
*
ÃÃ* +
Mathf
ÃÃ, 1
.
ÃÃ1 2
Tan
ÃÃ2 5
(
ÃÃ5 6
cam
ÃÃ6 9
.
ÃÃ9 :
fieldOfView
ÃÃ: E
*
ÃÃF G
$num
ÃÃH L
*
ÃÃM N
Mathf
ÃÃO T
.
ÃÃT U
Deg2Rad
ÃÃU \
)
ÃÃ\ ]
*
ÃÃ^ _
$num
ÃÃ` a
;
ÃÃa b
float
ÕÕ 

planeWidth
ÕÕ 
=
ÕÕ 
planeHeight
ÕÕ &
*
ÕÕ' (
cam
ÕÕ) ,
.
ÕÕ, -
aspect
ÕÕ- 3
;
ÕÕ3 4
rayTracingMat
œœ 
.
œœ 
	SetVector
œœ 
(
œœ  

ViewParams
œœ  *
,
œœ* +
new
œœ, /
Vector3
œœ0 7
(
œœ7 8

planeWidth
œœ8 B
,
œœB C
planeHeight
œœD O
,
œœO P
FocusDistance
œœQ ^
)
œœ^ _
)
œœ_ `
;
œœ` a
rayTracingMat
–– 
.
–– 
	SetMatrix
–– 
(
––  #
CamLocalToWorldMatrix
––  5
,
––5 6
cam
––7 :
.
––: ;
	transform
––; D
.
––D E 
localToWorldMatrix
––E W
)
––W X
;
––X Y
}
—— 
private
”” 
void
”” "
UpdateMaterialParams
”” %
(
””% &
)
””& '
{
””( )
HandleSpheres
‘‘ 
(
‘‘ 
)
‘‘ 
;
‘‘ 
HandleMeshes
’’ 
(
’’ 
)
’’ 
;
’’ 
rayTracingMat
◊◊ 
.
◊◊ 
SetInt
◊◊ 
(
◊◊ 
BounceCount
◊◊ (
,
◊◊( )
MaxBounceCount
◊◊* 8
)
◊◊8 9
;
◊◊9 :
rayTracingMat
ÿÿ 
.
ÿÿ 
SetInt
ÿÿ 
(
ÿÿ 
RaysPerPixel
ÿÿ )
,
ÿÿ) *
NumRaysPerPixel
ÿÿ+ :
)
ÿÿ: ;
;
ÿÿ; <
rayTracingMat
ŸŸ 
.
ŸŸ 
SetInt
ŸŸ 
(
ŸŸ 
RenderedFrames
ŸŸ +
,
ŸŸ+ ,
NumRenderedFrames
ŸŸ- >
)
ŸŸ> ?
;
ŸŸ? @
rayTracingMat
€€ 
.
€€ 
SetFloat
€€ 
(
€€ 
	Intensity
€€ (
,
€€( )
SunIntensity
€€* 6
)
€€6 7
;
€€7 8
rayTracingMat
‹‹ 
.
‹‹ 
SetFloat
‹‹ 
(
‹‹ 
Focus
‹‹ $
,
‹‹$ %
SunFocus
‹‹& .
)
‹‹. /
;
‹‹/ 0
rayTracingMat
ﬁﬁ 
.
ﬁﬁ 
SetFloat
ﬁﬁ 
(
ﬁﬁ 
Strength
ﬁﬁ '
,
ﬁﬁ' (
DivergeStrength
ﬁﬁ) 8
)
ﬁﬁ8 9
;
ﬁﬁ9 :
rayTracingMat
ﬂﬂ 
.
ﬂﬂ 
SetFloat
ﬂﬂ 
(
ﬂﬂ 
DefocusStrength1
ﬂﬂ /
,
ﬂﬂ/ 0
DefocusStrength
ﬂﬂ1 @
)
ﬂﬂ@ A
;
ﬂﬂA B
rayTracingMat
‡‡ 
.
‡‡ 
SetFloat
‡‡ 
(
‡‡ 
Distance
‡‡ '
,
‡‡' (
RenderDistance
‡‡) 7
)
‡‡7 8
;
‡‡8 9
rayTracingMat
‚‚ 
.
‚‚ 
SetColor
‚‚ 
(
‚‚ 
ColorHorizon
‚‚ +
,
‚‚+ ,
SkyColorHorizon
‚‚- <
)
‚‚< =
;
‚‚= >
rayTracingMat
„„ 
.
„„ 
SetColor
„„ 
(
„„ 
ColorZenith
„„ *
,
„„* +
SkyColorZenith
„„, :
)
„„: ;
;
„„; <
rayTracingMat
‰‰ 
.
‰‰ 
SetColor
‰‰ 
(
‰‰ 
GroundColor1
‰‰ +
,
‰‰+ ,
GroundColor
‰‰- 8
)
‰‰8 9
;
‰‰9 :
rayTracingMat
ÂÂ 
.
ÂÂ 
SetInt
ÂÂ 
(
ÂÂ 
UseEnvironment
ÂÂ +
,
ÂÂ+ ,
environment
ÂÂ- 8
?
ÂÂ9 :
$num
ÂÂ; <
:
ÂÂ= >
$num
ÂÂ? @
)
ÂÂ@ A
;
ÂÂA B
}
ÊÊ 
private
ËË 
void
ËË 
HandleSpheres
ËË 
(
ËË 
)
ËË  
{
ËË! "
Sphere
ÈÈ 
[
ÈÈ 
]
ÈÈ 
sphereArray
ÈÈ 
=
ÈÈ 
new
ÈÈ "
Sphere
ÈÈ# )
[
ÈÈ) *
spheres
ÈÈ* 1
.
ÈÈ1 2
Length
ÈÈ2 8
]
ÈÈ8 9
;
ÈÈ9 :
if
ÎÎ 

(
ÎÎ 
spheres
ÎÎ 
.
ÎÎ 
Length
ÎÎ 
==
ÎÎ 
$num
ÎÎ 
)
ÎÎ  
return
ÎÎ! '
;
ÎÎ' (
for
ÌÌ 
(
ÌÌ 
int
ÌÌ 
i
ÌÌ 
=
ÌÌ 
$num
ÌÌ 
;
ÌÌ 
i
ÌÌ 
<
ÌÌ 
spheres
ÌÌ #
.
ÌÌ# $
Length
ÌÌ$ *
;
ÌÌ* +
i
ÌÌ, -
++
ÌÌ- /
)
ÌÌ/ 0
{
ÌÌ1 2
sphereArray
ÓÓ 
[
ÓÓ 
i
ÓÓ 
]
ÓÓ 
=
ÓÓ 
new
ÓÓ  
Sphere
ÓÓ! '
{
ÓÓ( )
position
ÔÔ 
=
ÔÔ 
spheres
ÔÔ "
[
ÔÔ" #
i
ÔÔ# $
]
ÔÔ$ %
.
ÔÔ% &

gameObject
ÔÔ& 0
.
ÔÔ0 1
	transform
ÔÔ1 :
.
ÔÔ: ;
position
ÔÔ; C
,
ÔÔC D
radius
ÔÔE K
=
ÔÔL M
spheres
ÔÔN U
[
ÔÔU V
i
ÔÔV W
]
ÔÔW X
.
ÔÔX Y

gameObject
ÔÔY c
.
ÔÔc d
	transform
ÔÔd m
.
ÔÔm n

localScale
ÔÔn x
.
ÔÔx y
x
ÔÔy z
/
ÔÔ{ |
$num
ÔÔ} ~
,
ÔÔ~ 
material
 
=
 
spheres
 "
[
" #
i
# $
]
$ %
.
% &
material
& .
}
ÒÒ 
;
ÒÒ 
}
ÚÚ 	
sphereReader
ÙÙ 
.
ÙÙ 
SetData
ÙÙ 
(
ÙÙ 
sphereArray
ÙÙ (
)
ÙÙ( )
;
ÙÙ) *
rayTracingMat
ıı 
.
ıı 
SetInt
ıı 
(
ıı 
NumOfSpheres
ıı )
,
ıı) *
sphereArray
ıı+ 6
.
ıı6 7
Length
ıı7 =
)
ıı= >
;
ıı> ?
rayTracingMat
ˆˆ 
.
ˆˆ 
	SetBuffer
ˆˆ 
(
ˆˆ  
Spheres
ˆˆ  '
,
ˆˆ' (
sphereReader
ˆˆ) 5
)
ˆˆ5 6
;
ˆˆ6 7
}
˜˜ 
private
˘˘ 
void
˘˘ 
HandleMeshes
˘˘ 
(
˘˘ 
)
˘˘ 
{
˘˘  !
foreach
˙˙ 
(
˙˙ 
RayTracingMesh
˙˙ 
mesh
˙˙  $
in
˙˙% '
meshes
˙˙( .
)
˙˙. /
mesh
˙˙0 4
.
˙˙4 5
UpdateMeshData
˙˙5 C
(
˙˙C D
)
˙˙D E
;
˙˙E F
int
¸¸ 
size
¸¸ 
=
¸¸ 
meshes
¸¸ 
.
¸¸ 
Sum
¸¸ 
(
¸¸ 
mesh
¸¸ "
=>
¸¸# %
mesh
¸¸& *
.
¸¸* +
	triangles
¸¸+ 4
.
¸¸4 5
Count
¸¸5 :
)
¸¸: ;
;
¸¸; <
if
˛˛ 

(
˛˛ 
size
˛˛ 
==
˛˛ 
$num
˛˛ 
)
˛˛ 
return
˛˛ 
;
˛˛ 
Triangle
ÄÄ 
[
ÄÄ 
]
ÄÄ 
triangleArray
ÄÄ  
=
ÄÄ! "
new
ÄÄ# &
Triangle
ÄÄ' /
[
ÄÄ/ 0
size
ÄÄ0 4
]
ÄÄ4 5
;
ÄÄ5 6
MeshInfo
ÅÅ 
[
ÅÅ 
]
ÅÅ 
	meshInfos
ÅÅ 
=
ÅÅ 
new
ÅÅ "
MeshInfo
ÅÅ# +
[
ÅÅ+ ,
meshes
ÅÅ, 2
.
ÅÅ2 3
Length
ÅÅ3 9
]
ÅÅ9 :
;
ÅÅ: ;
int
ÉÉ 
triangleIndex
ÉÉ 
=
ÉÉ 
$num
ÉÉ 
;
ÉÉ 
for
ÑÑ 
(
ÑÑ 
int
ÑÑ 
i
ÑÑ 
=
ÑÑ 
$num
ÑÑ 
;
ÑÑ 
i
ÑÑ 
<
ÑÑ 
meshes
ÑÑ "
.
ÑÑ" #
Length
ÑÑ# )
;
ÑÑ) *
i
ÑÑ+ ,
++
ÑÑ, .
)
ÑÑ. /
{
ÑÑ0 1
	meshInfos
ÖÖ 
[
ÖÖ 
i
ÖÖ 
]
ÖÖ 
.
ÖÖ 
numTriangles
ÖÖ %
=
ÖÖ& '
meshes
ÖÖ( .
[
ÖÖ. /
i
ÖÖ/ 0
]
ÖÖ0 1
.
ÖÖ1 2
	triangles
ÖÖ2 ;
.
ÖÖ; <
Count
ÖÖ< A
;
ÖÖA B
	meshInfos
ÜÜ 
[
ÜÜ 
i
ÜÜ 
]
ÜÜ 
.
ÜÜ 
material
ÜÜ !
=
ÜÜ" #
meshes
ÜÜ$ *
[
ÜÜ* +
i
ÜÜ+ ,
]
ÜÜ, -
.
ÜÜ- .
material
ÜÜ. 6
;
ÜÜ6 7
	meshInfos
áá 
[
áá 
i
áá 
]
áá 
.
áá  
firstTriangleIndex
áá +
=
áá, -
triangleIndex
áá. ;
;
áá; <
for
ââ 
(
ââ 
int
ââ 
j
ââ 
=
ââ 
$num
ââ 
;
ââ 
j
ââ 
<
ââ 
meshes
ââ  &
[
ââ& '
i
ââ' (
]
ââ( )
.
ââ) *
	triangles
ââ* 3
.
ââ3 4
Count
ââ4 9
;
ââ9 :
j
ââ; <
++
ââ< >
)
ââ> ?
{
ââ@ A
triangleArray
ää 
[
ää 
triangleIndex
ää +
]
ää+ ,
=
ää- .
new
ää/ 2
Triangle
ää3 ;
{
ää< =
posA
ãã 
=
ãã 
meshes
ãã !
[
ãã! "
i
ãã" #
]
ãã# $
.
ãã$ %
	triangles
ãã% .
[
ãã. /
j
ãã/ 0
]
ãã0 1
.
ãã1 2
posA
ãã2 6
,
ãã6 7
posB
ãã8 <
=
ãã= >
meshes
ãã? E
[
ããE F
i
ããF G
]
ããG H
.
ããH I
	triangles
ããI R
[
ããR S
j
ããS T
]
ããT U
.
ããU V
posB
ããV Z
,
ããZ [
posC
ãã\ `
=
ããa b
meshes
ããc i
[
ããi j
i
ããj k
]
ããk l
.
ããl m
	triangles
ããm v
[
ããv w
j
ããw x
]
ããx y
.
ããy z
posC
ããz ~
,
ãã~ 
normalA
åå 
=
åå 
meshes
åå $
[
åå$ %
i
åå% &
]
åå& '
.
åå' (
	triangles
åå( 1
[
åå1 2
j
åå2 3
]
åå3 4
.
åå4 5
normalA
åå5 <
,
åå< =
normalB
åå> E
=
ååF G
meshes
ååH N
[
ååN O
i
ååO P
]
ååP Q
.
ååQ R
	triangles
ååR [
[
åå[ \
j
åå\ ]
]
åå] ^
.
åå^ _
normalB
åå_ f
,
ååf g
normalC
çç 
=
çç 
meshes
çç $
[
çç$ %
i
çç% &
]
çç& '
.
çç' (
	triangles
çç( 1
[
çç1 2
j
çç2 3
]
çç3 4
.
çç4 5
normalC
çç5 <
}
éé 
;
éé 
triangleIndex
êê 
++
êê 
;
êê  
}
ëë 
}
íí 	
triangleReader
îî 
.
îî 
SetData
îî 
(
îî 
triangleArray
îî ,
)
îî, -
;
îî- .

meshReader
ïï 
.
ïï 
SetData
ïï 
(
ïï 
	meshInfos
ïï $
)
ïï$ %
;
ïï% &
rayTracingMat
óó 
.
óó 
SetInt
óó 
(
óó 
	NumMeshes
óó &
,
óó& '
	meshInfos
óó( 1
.
óó1 2
Length
óó2 8
)
óó8 9
;
óó9 :
rayTracingMat
òò 
.
òò 
	SetBuffer
òò 
(
òò  
	Triangles
òò  )
,
òò) *
triangleReader
òò+ 9
)
òò9 :
;
òò: ;
rayTracingMat
ôô 
.
ôô 
	SetBuffer
ôô 
(
ôô  
AllMeshInfo
ôô  +
,
ôô+ ,

meshReader
ôô- 7
)
ôô7 8
;
ôô8 9
}
öö 
private
úú 
struct
úú 
Sphere
úú 
{
úú 
public
ùù 
Vector3
ùù 
position
ùù 
;
ùù  
public
ûû 
float
ûû 
radius
ûû 
;
ûû 
public
üü  
RayTracingMaterial
üü !
material
üü" *
;
üü* +
}
†† 
private
¢¢ 
struct
¢¢ 
Triangle
¢¢ 
{
¢¢ 
public
££ 
Vector3
££ 
posA
££ 
,
££ 
posB
££ !
,
££! "
posC
££# '
;
££' (
public
§§ 
Vector3
§§ 
normalA
§§ 
,
§§ 
normalB
§§  '
,
§§' (
normalC
§§) 0
;
§§0 1
}
•• 
private
ßß 
struct
ßß 
MeshInfo
ßß 
{
ßß 
public
®® 
int
®®  
firstTriangleIndex
®® %
;
®®% &
public
©© 
int
©© 
numTriangles
©© 
;
©©  
public
™™  
RayTracingMaterial
™™ !
material
™™" *
;
™™* +
}
´´ 
}¨¨ ø#
bC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Tests\CamTest.cs
[ 
ExecuteAlways 
] 
public 
class 
CamTest 
: 
MonoBehaviour $
{% &
[		 
SerializeField		 
]		 
private		 
bool		 !
run		" %
;		% &
[

 
SerializeField

 
]

 
private

 
Vector2

 $
debugPointCount

% 4
;

4 5
[ 
SerializeField 
] 
private 
float "
radius# )
;) *
private 
Camera 
cam 
; 
private 
void 
Start 
( 
) 
{ 
cam 
= 
Camera 
. 
main 
; 
} 
private 
void 
Update 
( 
) 
{ 
if 

( 
! 
run 
) 
return 
; 
	Transform 
camT 
= 
cam 
. 
	transform &
;& '
float 
planeHeight 
= 
cam 
.  
nearClipPlane  -
*. /
Mathf0 5
.5 6
Tan6 9
(9 :
cam: =
.= >
fieldOfView> I
*J K
$numL P
*Q R
MathfS X
.X Y
Deg2RadY `
)` a
*b c
$numd e
;e f
float 

planeWidth 
= 
planeHeight &
*' (
cam) ,
., -
aspect- 3
;3 4
Vector3 
bottomLeftLocal 
=  !
new" %
Vector3& -
(- .
-. /

planeWidth/ 9
/: ;
$num< =
,= >
-? @
planeHeight@ K
/L M
$numN O
,O P
camQ T
.T U
nearClipPlaneU b
)b c
;c d
for 
( 
int 
x 
= 
$num 
; 
x 
< 
debugPointCount +
.+ ,
x, -
;- .
x/ 0
++0 2
)2 3
{4 5
for   
(   
int   
y   
=   
$num   
;   
y   
<   
debugPointCount    /
.  / 0
y  0 1
;  1 2
y  3 4
++  4 6
)  6 7
{  8 9
float!! 
tx!! 
=!! 
x!! 
/!! 
(!!  
debugPointCount!!  /
.!!/ 0
x!!0 1
-!!2 3
$num!!4 6
)!!6 7
;!!7 8
float"" 
ty"" 
="" 
y"" 
/"" 
(""  
debugPointCount""  /
.""/ 0
y""0 1
-""2 3
$num""4 6
)""6 7
;""7 8
Vector3$$ 

pointLocal$$ "
=$$# $
bottomLeftLocal$$% 4
+$$5 6
new$$7 :
Vector3$$; B
($$B C

planeWidth$$C M
*$$N O
tx$$P R
,$$R S
planeHeight$$T _
*$$` a
ty$$b d
)$$d e
;$$e f
Vector3%% 
point%% 
=%% 
camT%%  $
.%%$ %
position%%% -
+%%. /
camT%%0 4
.%%4 5
right%%5 :
*%%; <

pointLocal%%= G
.%%G H
x%%H I
+%%J K
camT%%L P
.%%P Q
up%%Q S
*%%T U

pointLocal%%V `
.%%` a
y%%a b
+%%c d
camT%%e i
.%%i j
forward%%j q
*%%r s

pointLocal%%t ~
.%%~ 
z	%% Ä
;
%%Ä Å
using'' 
('' 
Draw'' 
.'' 
Command'' #
(''# $
cam''% (
)'') *
)''* +
Draw'', 0
.''0 1
Sphere''1 7
(''7 8
point''8 =
,''= >
radius''? E
,''E F
Color''G L
.''L M
white''M R
)''R S
;''S T
}(( 
})) 	
}** 
}++ ”
eC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Tests\Screenshot.cs
public 
class 

Screenshot 
: 
MonoBehaviour '
{( )
public 

void 
TakeScreenshot 
( 
)  
{! "
string 
	directory 
= 
Application &
.& '
dataPath' /
+0 1
$str2 <
;< =
if		 

(		 
!		 
	Directory		 
.		 
Exists		 
(		 
	directory		 '
)		' (
)		( )
	Directory		* 3
.		3 4
CreateDirectory		4 C
(		C D
	directory		D M
)		M N
;		N O
string 
fileName 
= 
$str "
+# $
DateTime% -
.- .
Now. 1
.1 2
ToString2 :
(: ;
$str; P
)P Q
+R S
$strT Z
;Z [
string 
filePath 
= 
Path 
. 
Combine &
(& '
	directory' 0
,0 1
fileName2 :
): ;
;; <
ScreenCapture 
. 
CaptureScreenshot '
(' (
filePath( 0
)0 1
;1 2
Debug 
. 
Log 
( 
$str &
+' (
filePath) 1
)1 2
;2 3
} 
} ó
cC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\MovementHelper.cs
public 
class 
MovementHelper 
{ 
public 

static 
Vector2  
GetResultingPosition .
(. /
Vector2/ 6
startPosition7 D
,D E
floatF K
angleDegreesL X
,X Y
floatZ _
distance` h
)h i
{j k
float 
angleRadians 
= 
( 
$num  
-! "
angleDegrees# /
)/ 0
*1 2
Mathf3 8
.8 9
Deg2Rad9 @
;@ A
float		 
deltaX		 
=		 
Mathf		 
.		 
Cos		  
(		  !
angleRadians		! -
)		- .
*		/ 0
distance		1 9
;		9 :
float

 
deltaY

 
=

 
Mathf

 
.

 
Sin

  
(

  !
angleRadians

! -
)

- .
*

/ 0
distance

1 9
;

9 :
Vector2 
resultingPosition !
=" #
startPosition$ 1
+2 3
new4 7
Vector28 ?
(? @
deltaX@ F
,F G
deltaYH N
)N O
;O P
return 
resultingPosition  
;  !
} 
public 

static 
float 
GetAngleInDegrees )
() *
Vector2* 1
point12 8
,8 9
Vector2: A
point2B H
)H I
{J K
Vector2 
	direction 
= 
point2 "
-# $
point1% +
;+ ,
float 
angleRadians 
= 
Mathf "
." #
Atan2# (
(( )
	direction) 2
.2 3
x3 4
,4 5
	direction6 ?
.? @
y@ A
)A B
;B C
float 
angleDegrees 
= 
angleRadians )
** +
Mathf, 1
.1 2
Rad2Deg2 9
;9 :
if 

( 
angleDegrees 
< 
$num 
) 
{ 	
angleDegrees 
+= 
$num 
;  
}   	
return"" 
angleDegrees"" 
;"" 
}## 
}$$ µ	
oC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Objects\RayTracingMaterial.cs
[ 
Serializable 
] 
public 
struct 
RayTracingMaterial  
{! "
[ 
Header 
( 
$str 
) 
] 
public 

Color 
color 
; 
public 

Color 
emissionColor 
; 
public		 

Color		 
specularColor		 
;		 
[ 
Header 
( 
$str 
) 
] 
public 

float 
emissionStrength !
;! "
[ 
Range 

(
 
$num 
, 
$num 
) 
] 
public 
float 

smoothness )
;) *
[ 
Range 

(
 
$num 
, 
$num 
) 
] 
public 
float 
specularProbability 2
;2 3
} É
iC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Objects\SphereObject.cs
[ 
ExecuteAlways 
] 
public 
class 
SphereObject 
: 
MonoBehaviour )
{* +
private 
static 
readonly 
int 

Glossiness  *
=+ ,
Shader- 3
.3 4
PropertyToID4 @
(@ A
$strA N
)N O
;O P
public 

RayTracingMaterial 
material &
;& '
private		 
Material		 
mat		 
;		 
private 
void 
Update 
( 
) 
{ 
if 

( 
mat 
== 
null 
) 
mat 
= 
new "
Material# +
(+ ,
Shader, 2
.2 3
Find3 7
(7 8
$str8 B
)B C
)C D
;D E
mat 
. 
color 
= 
material 
. 
color "
;" #
mat 
. 
SetFloat 
( 

Glossiness 
,  
material! )
.) *

smoothness* 4
)4 5
;5 6
GetComponent 
< 
MeshRenderer !
>! "
(" #
)# $
.$ %
material% -
=. /
mat0 3
;3 4
} 
} ë
iC:\Users\kdeen\OneDrive\Documents\Coding Projects\Camera-Simulator\Assets\Scripts\Tests\ShaderRenderer.cs
[ 
ExecuteAlways 
] 
public 
class 
ShaderRenderer 
: 
MonoBehaviour +
{, -
[ 
SerializeField 
] 
private 
Shader #
shader$ *
;* +
private 
Material 
rayTracingMat "
;" #
private		 
void		 
Start		 
(		 
)		 
=>		 
rayTracingMat		 )
=		* +
new		, /
Material		0 8
(		8 9
shader		9 ?
)		? @
;		@ A
private 
void 
OnRenderImage 
( 
RenderTexture ,
source- 3
,3 4
RenderTexture5 B
destinationC N
)N O
{P Q
if 

( 
Camera 
. 
current 
. 
name 
!=  "
$str# 0
)0 1
Graphics2 :
.: ;
Blit; ?
(? @
null@ D
,D E
destinationF Q
,Q R
rayTracingMatS `
)` a
;a b
else 
Graphics 
. 
Blit 
( 
source !
,! "
destination# .
). /
;/ 0
} 
} 